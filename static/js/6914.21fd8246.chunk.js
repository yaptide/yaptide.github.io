"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[6914],{6914:(t,e,i)=>{i.r(e),i.d(e,{TF1Painter:()=>h,produceTAxisLogScale:()=>l,scanTF1Options:()=>c});var s=i(9490),a=i(1597),n=i(6950),r=i(4913),o=i(4978),f=i(4041);function l(t,e,i,s){let a,n;s>0?(n=Math.log(s),a=i>0?Math.log(i):n-5):(n=-10,a=-15),t.fNbins=e,t.fXbins=new Array(e+1);for(let r=0;r<=e;++r)t.fXbins[r]=Math.exp(a+r/e*(n-a));t.fXmin=Math.exp(a),t.fXmax=Math.exp(n)}function c(t){(0,s.isStr)(t)||(t="");let e=t.indexOf(";webcanv_hist"),i=!1,a=0;return e>=0&&(i=!0,t=t.slice(0,e)),e=t.indexOf(";force_saved"),e>=0&&(a=2,t=t.slice(0,e)),e=t.indexOf(";prefer_saved"),e>=0&&(a=1,t=t.slice(0,e)),{opt:t,webcanv_hist:i,use_saved:a}}class h extends o.N{getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??s.clTF1}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(t){if(!t||this.getClassName()!==t._typename)return!1;delete t.evalPar;const e=this.getHisto();if(this.webcanv_hist){const t=this.getPadPainter()?.findInPrimitives("Func",s.clTH1D);t&&this.updateAxes(e,t,this.getFramePainter())}return this.$func=t,this.createTF1Histogram(t,e),this.scanContent(),!0}redraw(t){return this._use_saved_points||"logx"!==t&&"zoom"!==t||(this.createTF1Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(t)}createTF1Histogram(t,e){const i=this.getFramePainter(),a=this.getPadPainter()?.getRootPad(!0),n=a?.fLogx,r=i?.getGrFuncs(this.second_x,this.second_y);let o=t.fXmin,c=t.fXmax,h=Math.max(t.fNpx,100);if(r?.zoom_xmin!==r?.zoom_xmax){const t=(c-o)/h;o<r.zoom_xmin&&r.zoom_xmin<c&&(o=Math.max(o,r.zoom_xmin-t)),o<r.zoom_xmax&&r.zoom_xmax<c&&(c=Math.min(c,r.zoom_xmax+t))}this._use_saved_points=t.fSave.length>3&&(s.settings.PreferSavedPoints||this.use_saved>1);const m=t=>{e.fNcells!==t+2&&(e.fNcells=t+2,e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=t,e.fXaxis.fXbins=[]};if(delete this._fail_eval,!this._use_saved_points){let i=!1;if(!t.evalPar)try{(0,f.Dx)(t)||(i=!0)}catch{i=!0}m(h),n?l(e.fXaxis,h,o,c):(e.fXaxis.fXmin=o,e.fXaxis.fXmax=c);for(let s=0;s<h&&!i;s++){const a=e.fXaxis.GetBinCenter(s+1);let n=0;try{n=t.evalPar(a)}catch(x){i=!0}i||e.setBinContent(s+1,Number.isFinite(n)?n:0)}i&&(this._fail_eval=!0),i&&t.fSave.length>3&&(this._use_saved_points=!0)}if(this._use_saved_points){h=t.fSave.length-3;let i=null;if(o=t.fSave[h+1],c=t.fSave[h+2],o===c){const t=this.getMainPainter();(0,s.isFunc)(t?.getHisto)&&(i=t?.getHisto()?.fXaxis)}if(i){m(e.fXaxis.fNbins),Object.assign(e.fXaxis,i);for(let i=0;i<h;++i){const s=t.fSave[i];e.setBinContent(i+1,Number.isFinite(s)?s:0)}}else{m(t.fNpx),e.fXaxis.fXmin=t.fXmin,e.fXaxis.fXmax=t.fXmax;for(let i=0;i<t.fNpx;++i){const s=(0,f.YI)(t,e.fXaxis.GetBinCenter(i+1));e.setBinContent(i+1,Number.isFinite(s)?s:0)}}}e.fName="Func",(0,s.setHistogramTitle)(e,t.fTitle),e.fMinimum=t.fMinimum,e.fMaximum=t.fMaximum,e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize,e.fBits|=s.kNoStats}extractAxesProperties(t){super.extractAxesProperties(t);const e=this.$func,i=e?.fSave.length??0;i>3&&this._use_saved_points&&(this.xmin=Math.min(this.xmin,e.fSave[i-2]),this.xmax=Math.max(this.xmax,e.fSave[i-1])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax))}canZoomInside(t,e,i){const s=this.$func?.fSave.length??0;if(s>3&&this._use_saved_points&&"x"===t){const t=s-2,a=this.$func.fSave[s-2],n=this.$func.fSave[s-1];return Math.abs(n-a)/t<Math.abs(i-e)}return"x"===t||"y"===t}getTF1Tooltips(t){delete this.$tmp_tooltip;const e=[this.getObjectHint()],i=this.getFramePainter()?.getGrFuncs(this.options.second_x,this.options.second_y);if(!i||!(0,s.isFunc)(this.$func?.evalPar))return e.push("grx = "+t.x,"gry = "+t.y),e;const n=i.revertAxis("x",t.x);let r=0,o=0,f=!1;try{r=this.$func.evalPar(n),o=Math.round(i.gry(r))}catch{f=!0}return e.push("x = "+i.axisAsText("x",n),"value = "+(f?"<fail>":(0,a.lg)(r,s.gStyle.fStatFormat))),f||(this.$tmp_tooltip={y:r,gry:o}),e}processTooltipEvent(t){if(this._use_saved_points)return super.processTooltipEvent(t);let e=this.draw_g?.selectChild(".tooltip_bin");if(!this.draw_g||!t)return e?.remove(),null;const i={name:this.$func?.fName,title:this.$func?.fTitle,x:t.x,y:t.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF1Tooltips(t),exact:!0,menu:!0};return t.disabled?e.remove():(e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),e.attr("cx",t.x).attr("cy",this.$tmp_tooltip.gry??t.y).call(this.lineatt?.func)),i}fillWebObjectOptions(t){t.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static async draw(t,e,i){const a=c(i);let o;if(i=a.opt,delete a.opt,a.webcanv_hist){const e=new n.JW(t);o=e.getPadPainter()?.findInPrimitives("Func",s.clTH1D)}o||(o=(0,s.createHistogram)(s.clTH1D,100),o.fBits|=s.kNoStats),!i&&(0,n.Nn)(t)&&(i="same");const f=new h(t,o);return f.$func=e,Object.assign(f,a),f.createTF1Histogram(e,o),r.mf._drawHist(f,i)}}}}]);
//# sourceMappingURL=6914.21fd8246.chunk.js.map