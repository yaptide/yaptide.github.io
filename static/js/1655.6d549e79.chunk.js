"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[1655],{1655:(t,e,i)=>{i.r(e),i.d(e,{RH1Painter:()=>c});var n=i(9490),s=i(8260),r=i(1597),a=i(7663),o=i(4709);class h extends a.G{constructor(t,e){super(t,e),this.wheel_zoomy=!1}scanContent(t){const e=this.getHisto();if(!e)return;!this.nbinsx&&t&&(t=!1),t||this.extractAxesProperties(1);let i=0,n=0,s=0,r=0;if(this.isDisplayItem())i=e.fContMin,n=e.fContMinPos,s=e.fContMax,r=s;else{const a=this.getSelectIndex("x","left"),o=this.getSelectIndex("x","right");if(t&&a===this.scan_xleft&&o===this.scan_xright)return;this.scan_xleft=a,this.scan_xright=o;let h,l,d=!0;for(let t=0;t<this.nbinsx;++t)h=e.getBinContent(t+1),r+=h,t<a||t>=o||(h>0&&(0===n||h<n)&&(n=h),d&&(i=s=h,d=!1),l=0,i=Math.min(i,h-l),s=Math.max(s,h+l))}if(this.stat_entries=r,this.hmin=i,this.hmax=s,this.ymin_nz=n,0===this.nbinsx||Math.abs(i)<1e-300&&Math.abs(s)<1e-300?this.draw_content=!1:this.draw_content=!0,this.draw_content)if(i>=s)0===i?(this.ymin=0,this.ymax=1):i<0?(this.ymin=2*i,this.ymax=0):(this.ymin=0,this.ymax=2*i);else{const t=.05*(s-i);this.ymin=i-t,this.ymin<0&&i>=0&&(this.ymin=0),this.ymax=s+t}}countStat(t){const e=this.getHisto(),i=this.getAxis("x"),n=this.getSelectIndex("x","left"),s=this.getSelectIndex("x","right"),r={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};let a,o=0,h=0,l=0,d=0,c=0,g=null,u=null;for(a=n;a<s;++a)d=i.GetBinCoord(a+.5),t&&!t(d)||(c=e.getBinContent(a+1),(null===g||c>u)&&(g=d,u=c),o+=c,h+=c*d,l+=c*d**2);return r.integral=o,Math.abs(o)>1e-300&&(r.meanx=h/o,r.meany=0/o,r.rmsx=Math.sqrt(Math.abs(l/o-r.meanx**2)),r.rmsy=Math.sqrt(Math.abs(0/o-r.meany**2))),null!==g&&(r.xmax=g,r.wmax=u),r}fillStatistic(t,e){const i=this.getHisto(),n=this.countStat(),s=e%10,r=Math.floor(e/10)%10,a=Math.floor(e/100)%10,o=Math.floor(e/1e3)%10,h=Math.floor(e/1e4)%10,l=Math.floor(e/1e5)%10,d=Math.floor(e/1e6)%10,c=Math.floor(e/1e7)%10,g=Math.floor(e/1e8)%10;return t.clearStat(),s>0&&t.addText(n.name),r>0&&t.addText("Entries = "+t.format(n.entries,"entries")),a>0&&t.addText("Mean = "+t.format(n.meanx)),o>0&&t.addText("Std Dev = "+t.format(n.rmsx)),h>0&&t.addText("Underflow = "+t.format(i.getBinContent(0),"entries")),l>0&&t.addText("Overflow = "+t.format(i.getBinContent(this.nbinsx+1),"entries")),d>0&&t.addText("Integral = "+t.format(n.integral,"entries")),c>0&&t.addText("Skew = <not avail>"),g>0&&t.addText("Kurt = <not avail>"),!0}async drawBars(t,e,i,n){this.createG(!0);const r=t.i1,a=t.i2,o=t.stepi,h=this.getFramePainter(),l=this.getHisto(),d=this.getAxis("x");let c,g,u,x,p,f,m,y,M,w="",_="",B="";for(y=h.swap_xy?0:n,Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=e.scale_ymin&&(y=Math.round(e.gry(this.options.BaseLine))),c=r;c<a;c+=o)g=d.GetBinCoord(c),u=d.GetBinCoord(c+o),e.logx&&u<=0||(x=Math.round(e.grx(g)),p=Math.round(e.grx(u)),f=l.getBinContent(c+1),e.logy&&f<e.scale_ymin||(m=Math.round(e.gry(f)),M=p-x,x+=Math.round(this.options.BarOffset*M),M=Math.round(this.options.BarWidth*M),h.swap_xy?w+=`M${y},${x}h${m-y}v${M}h${y-m}z`:w+=`M${x},${m}h${M}v${y-m}h${-M}z`,this.options.BarStyle>0&&(p=x+M,M=Math.round(M/10),h.swap_xy?(_+=`M${y},${x}h${m-y}v${M}h${y-m}z`,B+=`M${y},${p}h${m-y}v${-M}h${y-m}z`):(_+=`M${x},${m}h${M}v${y-m}h${-M}z`,B+=`M${p},${m}h${-M}v${y-m}h${M}z`))));return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),w&&this.draw_g.append("svg:path").attr("d",w).call(this.fillatt.func),_&&this.draw_g.append("svg:path").attr("d",_).call(this.fillatt.func).style("fill",(0,s.Qh)(this.fillatt.color).brighter(.5).formatHex()),B&&this.draw_g.append("svg:path").attr("d",B).call(this.fillatt.func).style("fill",(0,s.Qh)(this.fillatt.color).darker(.5).formatHex()),!0}async drawFilledErrors(t,e){this.createG(!0);const i=t.i1,n=t.i2,s=t.stepi,a=this.getHisto(),o=this.getAxis("x"),h=[],l=[];let d,c,g,u,x,p;for(d=i;d<n;d+=s)c=o.GetBinCoord(d+.5),e.logx&&c<=0||(g=Math.round(e.grx(c)),u=a.getBinContent(d+1),x=a.getBinError(d+1),e.logy&&u-x<e.scale_ymin||(p=Math.round(e.gry(u+x)),h.push({grx:g,gry:p}),p=Math.round(e.gry(u-x)),l.unshift({grx:g,gry:p})));const f=(0,r.Mw)(h,{line:4!==this.options.ErrorKind}),m=(0,r.Mw)(l,{line:4!==this.options.ErrorKind,cmd:"L"});return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),this.draw_g.append("svg:path").attr("d",f+m+"Z").call(this.fillatt.func),!0}async draw1DBins(){const t=this.getFramePainter(),e=t.getFrameRect();if(!this.draw_content||e.width<=0||e.height<=0)return this.removeG(),!1;this.createHistDrawAttributes();const i=this.prepareDraw({extra:1,only_indexes:!0}),n=t.getGrFuncs(this.options.second_x,this.options.second_y);return this.options.Bar?this.drawBars(i,n,e.width,e.height):3===this.options.ErrorKind||4===this.options.ErrorKind?this.drawFilledErrors(i,n,e.width,e.height):this.drawHistBins(i,n,e.width,e.height)}async drawHistBins(t,e,i,s){this.createG(!0);const a=this.options,o=t.i1,h=t.i2,l=t.stepi,d=this.getHisto(),c=!this.isBatchMode()&&n.settings.Tooltip,g=this.getAxis("x"),u=!a.Zero,x=a.Error,p=a.Line,f=a.Text;let m,y,M,w,_,B,v,$,b,C,D,E,S,A,k,F,T,H,z,P,G,L,I,K=a.Mark,R="",O=!1,Z=null,j=null,X=null,W=null,q=null,Q="",N="",U=0;if(x&&!K&&this.v7EvalAttr("marker_style",1)>1&&(K=!0),2===a.ErrorKind?this.fillatt.empty()?K=!0:Z="":a.Error&&(j="",q=c?"":null),p&&(W=""),K&&(this.createv7AttMarker(),this.markeratt.size>0?(X="",this.markeratt.resetPos()):K=!1),f){if(I=this.v7EvalFont("text",{size:20,color:"black",align:22}),!I.angle&&!a.TextKind){const t=i/(h-o+1);t<3*I.size&&(I.setAngle(270),I.setSize(Math.round(.7*t)))}this.startTextDrawing(I,"font")}let Y=h-o>3*i;if(1===a.ErrorKind){const t=this.lineatt.width+n.gStyle.fEndErrorSize;Q=`m0,${t}v${-2*t}m0,${t}`,N=`m${t},0h${-2*t}m${t},0`,U=Math.floor((this.lineatt.width-1)/2)}const J=x||K;(J||f||p)&&(Y=!0);const V=t=>{if(H=d.getBinContent(t+1),!u||0!==H){if(P=Math.round(e.grx(g.GetBinCoord(t))),G=Math.round(e.grx(g.GetBinCoord(t+l))),L=Math.round((P+G)/2),k=Math.round(e.gry(H)),F=T=20,x&&(z=d.getBinError(t+1),F=Math.round(k-e.gry(H+z)),T=Math.round(e.gry(H-z)-k)),f&&0!==H){const t=H===Math.round(H)?H.toString():(0,r.lg)(H,n.gStyle.fPaintTextFormat);I.angle?this.drawText({align:12,x:L,y:Math.round(k-2-I.size/5),text:t,latex:0}):this.drawText({x:Math.round(P+.1*(G-P)),y:Math.round(k-2-I.size),width:Math.round(.8*(G-P)),height:I.size,text:t,latex:0})}if(p&&null!==W&&(W+=(0===W.length?"M":"L")+L+","+k),J&&k>=-F&&k<=s+T&&(null!==Z&&(Z+=`M${P},${k-F}h${G-P}v${F+T+1}h${P-G}z`),null!==X&&(X+=this.markeratt.create(L,k)),null!==j)){let t=5;if(this.options.errorX>0){t=Math.round((G-P)*this.options.errorX);const e=L-t;j+=`M${e+U},${k}${Q}h${L+t-e-2*U}${Q}`}j+=`M${L},${k-F+U}${N}v${F+T-2*U}${N}`,null!==q&&(q+=`M${L-t},${k-F}h${2*t}v${F+T}h${-2*t}z`)}}};for(E=o;E<=h;E+=l)w=g.GetBinCoord(E),e.logx&&w<=0||(_=Math.round(e.grx(w)),O=E>h-l,O&&o<h?v=M:(B=d.getBinContent(E+1),v=Math.round(e.gry(B))),0===R.length?(S=A=E,D=m=y=_,C=$=b=M=v,R="M"+y+","+M):Y?_!==y||O?((J||f||p)&&(S===A?V(S):S<A?(V(S),V(A)):(V(A),V(S))),J||$===b&&C===$||(D!==y&&(R+="h"+(y-D)),M===$?(b!==C&&(R+="v"+(b-C)),$!==b&&(R+="v"+($-b))):($!==C&&(R+="v"+($-C)),b!==$&&(R+="v"+(b-$)),M!==b&&(R+="v"+(M-b))),D=y,C=M),O&&D!==_&&(R+="h"+(_-D)),S=A=E,$=b=M=v,y=_):(v<$?A=E:v>b&&(S=E),$=Math.min($,v),b=Math.max(b,v),M=v):(v!==M||O)&&(_!==y&&(R+="h"+(_-y)),v!==M&&(R+="v"+(v-M)),M=v,y=_));const tt=!this.isBatchMode()&&this.fillatt.empty()&&a.Hist&&n.settings.Tooltip&&!J&&!p;let et=s+3;if(!tt){const t=Math.round(e.gry(0));t<=0?et=-3:t<s&&(et=t)}const it=`L${y},${et}H${m}Z`;return J||p?(Z&&this.draw_g.append("svg:path").attr("d",Z).call(this.fillatt.func),j&&this.draw_g.append("svg:path").attr("d",j).call(this.lineatt.func),q&&this.draw_g.append("svg:path").attr("d",q).style("fill","none").style("pointer-events",this.isBatchMode()?null:"visibleFill"),W&&(this.fillatt.empty()||a.Hist||this.draw_g.append("svg:path").attr("d",W+it).call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",W).style("fill","none").call(this.lineatt.func)),X&&this.draw_g.append("svg:path").attr("d",X).call(this.markeratt.func)):R&&a.Hist&&this.draw_g.append("svg:path").attr("d",R+(!this.fillatt.empty()||tt?it:"")).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func),!f||this.finishTextDrawing()}getBinTooltips(t){const e=[],i=this.getObjectHint(),s=this.getFramePainter(),a=this.getHisto(),o=this.getAxis("x"),h=this.isDisplayItem()?a.stepx:1,l=o.GetBinCoord(t),d=o.GetBinCoord(t+h),c=this.getAxisBinTip("x",t,h);let g=a.getBinContent(t+1);if(i&&e.push(i),this.options.Error||this.options.Mark)e.push(`x = ${c}`,`y = ${s.axisAsText("y",g)}`),this.options.Error&&("["===c[0]&&e.push("error x = "+((d-l)/2).toPrecision(4)),e.push("error y = "+a.getBinError(t+1).toPrecision(4)));else{e.push(`bin = ${t+1}`,`x = ${c}`),a.$baseh&&(g-=a.$baseh.getBinContent(t+1));const i="entries = "+(h>1?"~":"");g===Math.round(g)?e.push(i+g):e.push(i+(0,r.lg)(g,n.gStyle.fStatFormat))}return e}processTooltipEvent(t){let e=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_content||this.options.Mode3D||!this.draw_g)return e?.remove(),null;const i=this.getFramePainter(),n=i.getGrFuncs(this.options.second_x,this.options.second_y),s=i.getFrameWidth(),a=i.getFrameHeight(),o=this.getHisto(),h=this.getAxis("x"),l=this.getSelectIndex("x","left",-1),d=this.getSelectIndex("x","right",2);let c,g,u,x,p,f=null,m=2,y=l,M=d;function w(t){const e=h.GetBinCoord(t);return n.logx&&e<=0?null:n.grx(e)}function _(t){const e=o.getBinContent(t+1);return n.logy&&e<n.scale_ymin?n.swap_xy?-1e3:10*a:Math.round(n.gry(e))}const B=n.swap_xy?t.y:t.x,v=n.swap_xy?t.x:t.y;for(;y<M-1;){const t=Math.round(.5*(y+M)),e=w(t);null===e||e<B-.5?n.swap_xy?M=t:y=t:e>B+.5?n.swap_xy?y=t:M=t:(y++,M--)}if(f=M=y,g=w(f),n.swap_xy){for(;y>l&&w(y-1)<g+2;)--y;for(;M<d&&w(M+1)>g-2;)++M}else{for(;y>l&&w(y-1)>g-2;)--y;for(;M<d&&w(M+1)<g+2;)++M}if(y<M){let t=a;for(let e=y;e<=M;e++){const i=Math.abs(_(e)-v);i<t&&(t=i,f=e)}t>a/10&&(f=Math.round(y+(M-y)/a*v)),g=w(f)}if(g=Math.round(g),u=Math.round(w(f+1)),this.options.Bar){const t=u-g;g+=Math.round(this.options.BarOffset*t),u=g+Math.round(this.options.BarWidth*t)}if(g>u&&([g,u]=[u,g]),this.isDisplayItem()&&(f<=o.dx||f>=o.dx+o.nx))return e.remove(),null;const $=Math.round((g+u)/2),b=x=p=_(f);if(this.options.Bar)c=!0,m=0,x=Math.round(n.gry(!1!==this.options.BaseLine&&this.options.BaseLine>n.scale_ymin?this.options.BaseLine:n.scale_ymin)),x>p&&([x,p]=[p,x]),t.touch||1!==t.nproc||(v<x||v>p)&&(f=null);else if(this.options.Error||this.options.Mark){c=!0;let e=3;if(this.markeratt&&(e=Math.max(e,this.markeratt.getFullSize())),this.options.Error){const t=o.getBinContent(f+1),e=o.getBinError(f+1);x=Math.round(n.gry(t+e)),p=Math.round(n.gry(t-e));const i=(u-g)*this.options.errorX;g=Math.round($-i),u=Math.round($+i)}u-g<2*e&&(g=$-e,u=$+e),x=Math.min(x,b-e),p=Math.max(p,b+e),t.touch||1!==t.nproc||(v<x||v>p)&&(f=null)}else this.options.Line?c=!1:(c=1===t.nproc&&d-l<s,c&&(p=a,this.fillatt.empty()||(p=Math.min(a,Math.max(0,Math.round(n.gry(0)))),p<x&&([x,p]=[p,x])),(t.y<x||t.y>p)&&!t.touch&&(f=null)));if(null!==f&&(f===l&&g>B+m||f===d-1&&u<B-m||B<g-m||B>u+m?f=null:this.options.Zero||0!==o.getBinContent(f+1)||(f=null)),null===f||p<=0||x>=a)return e.remove(),null;const C={name:"histo",title:o.fTitle,x:$,y:b,exact:!0,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(f)};if(t.disabled)e.remove(),C.changed=!0;else if(c)e.empty()&&(e=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(r.Ru)),C.changed=e.property("current_bin")!==f,C.changed&&e.attr("x",i.swap_xy?x:g).attr("width",i.swap_xy?p-x:u-g).attr("y",i.swap_xy?g:x).attr("height",i.swap_xy?u-g:p-x).style("opacity","0.3").property("current_bin",f),C.exact=Math.abs(b-v)<=5||v>=x&&v<=p,C.menu=C.exact,C.menu_dist=Math.sqrt(($-B)**2+(b-v)**2);else{const i=this.lineatt.width+3;e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",i).call(this.lineatt.func).call(this.fillatt.func)),C.exact=Math.abs($-t.x)<=i&&Math.abs(b-t.y)<=i,C.menu=C.exact,C.menu_dist=Math.sqrt(($-t.x)**2+(b-t.y)**2),C.changed=e.property("current_bin")!==f,C.changed&&e.attr("cx",$).attr("cy",b).property("current_bin",f)}return C.changed&&(C.user_info={obj:o,name:"histo",bin:f,cont:o.getBinContent(f+1),grx:$,gry:b}),C}fillHistContextMenu(t){t.add("Auto zoom-in",(()=>this.autoZoom()));const e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if(0===t.indexOf(n.kInspect))return this.showInspector(t);this.decodeOptions(t),this.options.need_fillcol&&this.fillatt?.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")}))}autoZoom(){let t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1);const i=e-t,n=this.getHisto(),s=this.getAxis("x");if(0===i)return;let r=n.getBinContent(t+1);for(let a=t;a<e;++a)r=Math.min(r,n.getBinContent(a+1));if(!(r>0)){for(;t<e&&n.getBinContent(t+1)<=r;)++t;for(;t<e&&n.getBinContent(e)<=r;)--e;return t===e-1&&t>2&&e<this.nbinsx-2&&(--t,++e),e-t<i&&t<e?this.getFramePainter().zoom(s.GetBinCoord(t),s.GetBinCoord(e)):void 0}}canZoomInside(t,e,i){const n=this.getAxis("x");return"x"===t&&n.FindBin(i,.5)-n.FindBin(e,0)>1||"y"===t&&Math.abs(i-e)>1e-6*Math.abs(this.ymax-this.ymin)}async callDrawFunc(t){const e=this.getFramePainter();return e&&e.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=e.mode3d),this.options.Mode3D?this.draw3D(t):this.draw2D(t)}async draw2D(t){return this.clear3DScene(),this.drawFrameAxes().then((e=>!!e&&this.drawingBins(t))).then((t=>{if(t)return this.draw1DBins().then((()=>this.addInteractivity()))})).then((()=>this))}async draw3D(t){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),this.draw2D(t)}async redraw(t){return this.callDrawFunc(t)}static async _draw(t,e){return(0,o.ensureRCanvas)(t).then((()=>{t.setAsMainPainter(),t.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:n.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1,FrontBox:!1,BackBox:!1};const i=new r.nC(e);i.check("R3D_",!0)&&(t.options.Render3D=n.constants.Render3D.fromString(i.part.toLowerCase()));const s=t.v7EvalAttr("kind","hist"),a=t.v7EvalAttr("sub",0),o=!!t.getMainPainter(),h=t.options;switch(h.Text=t.v7EvalAttr("drawtext",!1),h.BarOffset=t.v7EvalAttr("baroffset",0),h.BarWidth=t.v7EvalAttr("barwidth",1),h.second_x=o&&t.v7EvalAttr("secondx",!1),h.second_y=o&&t.v7EvalAttr("secondy",!1),s){case"bar":h.Bar=!0,h.BarStyle=a;break;case"err":h.Error=!0,h.ErrorKind=a;break;case"p":h.Mark=!0;break;case"l":h.Line=!0;break;case"lego":h.Lego=a>0?10+a:12,h.Mode3D=!0;break;default:h.Hist=!0}return t.scanContent(),t.callDrawFunc()}))}static async draw(t,e,i){return h._draw(new h(t,e),i)}}var l=i(8094),d=i(227);class c extends h{draw3D(t){this.mode3d=!0;const e=this.getFramePainter(),i=this.isMainPainter(),s=1+2*n.gStyle.fHistTopMargin;let r=Promise.resolve(this);return"resize"===t?(i&&e.resize3D()&&e.render3D(),r):(this.deleteAttr(),this.scanContent(!0),i&&((0,d.wx)(e),r=e.create3DScene(this.options.Render3D).then((()=>{e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,l.R,{use_y_for_z:!0,zmult:s,zoom:n.settings.Zooming,ndim:1,draw:!0,v7:!0})}))),e.mode3d?r.then((()=>this.drawingBins(t))).then((()=>{const t=this.getFramePainter();return(0,d.CS)(this,!0),this.updatePaletteDraw(),t.render3D(),t.addKeysHandler(),this})):r)}static async draw(t,e,i){return c._draw(new c(t,e),i)}}}}]);
//# sourceMappingURL=1655.6d549e79.chunk.js.map