"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[4104],{4104:(t,e,i)=>{i.r(e),i.d(e,{RH2Painter:()=>c});var n=i(9490),r=i(8260),s=i(1597),o=i(7663),a=i(4709),h=i(6183);class l extends o.G{constructor(t,e){super(t,e),this.wheel_zoomy=!0}cleanup(){delete this.tt_handle,super.cleanup()}getDimension(){return 2}toggleProjection(t,e){"Projections"!==t&&"Off"!==t||(t="");let i=e,r=e;if((0,n.isStr)(t)&&0===t.indexOf("XY")){const e=t.length>2?t.slice(2):"";t="XY",i=r=parseInt(e)}else if((0,n.isStr)(t)&&t.length>1){const e=t.indexOf("_");e>0&&"X"===t[0]&&"Y"===t[e+1]?(i=parseInt(t.slice(1,e))||1,r=parseInt(t.slice(e+2))||1,t="XY"):e>0&&"Y"===t[0]&&"X"===t[e+1]?(r=parseInt(t.slice(1,e))||1,i=parseInt(t.slice(e+2))||1,t="XY"):(i=r=parseInt(t.slice(1))||1,t=t[0])}if(i||r||(i=r=1),t&&this.is_projection===t){if(this.projection_widthX!==i||this.projection_widthY!==r)return this.projection_widthX=i,void(this.projection_widthY=r);t=""}delete this.proj_hist;const s=this.is_projection===t?"":t;this.projection_widthX=i,this.projection_widthY=r,this.is_projection="",this.provideSpecialDrawArea(s).then((()=>(this.is_projection=s,this.redrawProjection())))}redrawProjection(){}executeMenuCommand(t,e){return!!super.executeMenuCommand(t,e)||("SetShowProjectionX"===t.fName||"SetShowProjectionY"===t.fName)&&(this.toggleProjection(t.fName[17],e&&parseInt(e)?parseInt(e):1),!0)}fillHistContextMenu(t){if(this.getPadPainter()?.iscan){let e=this.is_projection||"";e&&(e+=this.projection_widthX),this.projection_widthX!==this.projection_widthY&&"XY"===this.is_projection&&(e=`X${this.projection_widthX}_Y${this.projection_widthY}`);const i=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10","XY1","XY2","XY3","XY5","XY10"];e&&i.unshift("Off"),t.add("sub:Projections",(()=>t.input("Input projection kind X1 or XY2 or X3_Y4",e,"string").then((t=>this.toggleProjection(t)))));for(let n=0;n<i.length;++n)t.addchk(e===i[n],i[n],i[n],(t=>this.toggleProjection(t)));t.add("endsub:")}t.add("Auto zoom-in",(()=>this.autoZoom()));const e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if(0===t.indexOf(n.kInspect))return this.showInspector(t);this.decodeOptions(t),this.interactiveRedraw("pad","drawopt")})),this.options.Color&&this.fillPaletteMenu(t)}clickButton(t){const e=super.clickButton(t);if(e)return e;switch(t){case"ToggleColor":return this.toggleColor();case"Toggle3D":return this.toggleMode3D()}return!1}fillToolbar(){super.fillToolbar(!0);const t=this.getPadPainter();t&&(t.addPadButton("th2color","Toggle color","ToggleColor"),t.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),t.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),t.showPadButtons())}toggleColor(){return this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color,this.redraw()}autoZoom(){const t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1),i=this.getSelectIndex("y","left",-1),n=this.getSelectIndex("y","right",1),r=this.getHisto(),s=this.getAxis("x"),o=this.getAxis("y");if(t===e||i===n)return;let a=r.getBinContent(t+1,i+1);for(let f=t;f<e;++f)for(let t=i;t<n;++t)a=Math.min(a,r.getBinContent(f+1,t+1));if(a>0)return;let h=e,l=t,d=n,g=i;for(let f=t;f<e;++f)for(let t=i;t<n;++t)r.getBinContent(f+1,t+1)>a&&(f<h&&(h=f),f>=l&&(l=f+1),t<d&&(d=t),t>=g&&(g=t+1));let c,x,p,m,u=!1;return h===l-1&&h>t+1&&l<e-1&&(h--,l++),d===g-1&&d>i+1&&g<n-1&&(d--,g++),(h>t||l<e)&&h<l-1&&(c=s.GetBinCoord(h),x=s.GetBinCoord(l),u=!0),(d>i||g<n)&&d<g-1&&(p=o.GetBinCoord(d),m=o.GetBinCoord(g),u=!0),u?this.getFramePainter().zoom(c,x,p,m):void 0}scanContent(t){if(t&&this.nbinsx&&this.nbinsy)return;const e=this.getHisto();if(this.extractAxesProperties(2),this.isDisplayItem())this.gminbin=e.fContMin,this.gminposbin=e.fContMinPos>0?e.fContMinPos:null,this.gmaxbin=e.fContMax;else{this.gminbin=this.gmaxbin=e.getBinContent(1,1),this.gminposbin=null;for(let t=0;t<this.nbinsx;++t)for(let i=0;i<this.nbinsy;++i){const n=e.getBinContent(t+1,i+1);n<this.gminbin?this.gminbin=n:n>this.gmaxbin&&(this.gmaxbin=n),n>0&&(null===this.gminposbin||this.gminposbin>n)&&(this.gminposbin=n)}}this.zmin=this.gminbin,this.zmax=this.gmaxbin,null===this.gminposbin&&this.gmaxbin>0&&(this.gminposbin=1e-4*this.gmaxbin),this.options.Axis>0?this.draw_content=!1:this.draw_content=0!==this.gmaxbin||0!==this.gminbin}countStat(t){const e=this.getHisto(),i={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},n=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),s=this.getSelectIndex("y","left"),o=this.getSelectIndex("y","right"),a=this.getAxis("x"),h=this.getAxis("y");let l,d,g,c,x,p,m,u=0,f=0,y=0,w=0,M=0;for(p=1;p<=this.nbinsx;++p)for(l=p<=n+1?0:p>r+1?2:1,g=a.GetBinCoord(p-.5),m=1;m<=this.nbinsy;++m)d=m<=s+1?0:m>o+1?2:1,c=h.GetBinCoord(m-.5),x=e.getBinContent(p,m),i.entries+=x,i.matrix[3*d+l]+=x,1===l&&1===d&&(t&&!t(g,c)||((null===i.wmax||x>i.wmax)&&(i.wmax=x,i.xmax=g,i.ymax=c),u+=x,f+=g*x,y+=c*x,w+=g**2*x,M+=c**2*x));return Math.abs(u)>1e-300&&(i.meanx=f/u,i.meany=y/u,i.rmsx=Math.sqrt(Math.abs(w/u-i.meanx**2)),i.rmsy=Math.sqrt(Math.abs(M/u-i.meany**2))),null===i.wmax&&(i.wmax=0),i.integral=u,i}fillStatistic(t,e){const i=this.countStat(),n=Math.floor(e%10),r=Math.floor(e/10)%10,s=Math.floor(e/100)%10,o=Math.floor(e/1e3)%10,a=Math.floor(e/1e4)%10,h=Math.floor(e/1e5)%10,l=Math.floor(e/1e6)%10,d=Math.floor(e/1e7)%10,g=Math.floor(e/1e8)%10;if(t.clearStat(),n>0&&t.addText(i.name),r>0&&t.addText("Entries = "+t.format(i.entries,"entries")),s>0&&(t.addText("Mean x = "+t.format(i.meanx)),t.addText("Mean y = "+t.format(i.meany))),o>0&&(t.addText("Std Dev x = "+t.format(i.rmsx)),t.addText("Std Dev y = "+t.format(i.rmsy))),l>0&&t.addText("Integral = "+t.format(i.matrix[4],"entries")),d>0&&(t.addText("Skewness x = <undef>"),t.addText("Skewness y = <undef>")),g>0&&t.addText("Kurt = <undef>"),a>0||h>0){const e=i.matrix;t.addText(e[6].toFixed(0)+" | "+e[7].toFixed(0)+" | "+e[7].toFixed(0)),t.addText(e[3].toFixed(0)+" | "+e[4].toFixed(0)+" | "+e[5].toFixed(0)),t.addText(e[0].toFixed(0)+" | "+e[1].toFixed(0)+" | "+e[2].toFixed(0))}return!0}drawBinsColor(){const t=this.getHisto(),e=this.prepareDraw(),i=e.stepi,n=e.stepj,r=[];let s,o,a,h,l,d,g,c,x,p;const m=()=>{p.path+=`h${g}v${p.y2-p.y}h${-g}z`,p.dy=0,p=null};for(h=e.i1;h<e.i2;h+=i){for(g=e.grx[h+i]-e.grx[h]||1,l=e.j1;l<e.j2;l+=n)if(d=t.getBinContent(h+1,l+1),s=e.palette.getContourIndex(d),0===d&&(this.options.Zero?null===s&&this._show_empty_bins&&(s=0):s=null),null!==s){if(o=`M${e.grx[h]},${e.gry[l]}`,c=e.gry[l+n]-e.gry[l]||-1,x=r[s],void 0===x)x=r[s]={path:o};else{if(x===p){x.y2=e.gry[l]+c;continue}a=`m${e.grx[h]-x.x},${e.gry[l]-x.y}`,x.path+=a.length<o.length?a:o}p&&m(),x.x=e.grx[h],x.y=e.gry[l],x.y2=e.gry[l]+c,p=x}else p&&m();p&&m()}return r.forEach(((t,i)=>{t&&this.draw_g.append("svg:path").style("fill",e.palette.getColor(i)).attr("d",t.path)})),this.updatePaletteDraw(),e}drawBinsContour(t,e,i){const n=this.prepareDraw({rounding:!1,extra:100}),r=this.getFramePainter(),s=r.getHistPalette(),o=s.getContour(),a=r.getProjectionFunc();return 14===this.options.Contour&&this.draw_g.append("svg:path").attr("d",`M0,0h${e}v${i}h${-e}z`).style("fill",s.getColor(0)),(0,h.Hn)(this.getHisto(),n,o,s,((e,i,n,r,o)=>{const h=s.getColor(e);let l,d=h;switch(this.options.Contour){case 1:case 14:break;case 11:d="none",l=this.createAttLine({color:h,std:!1});break;case 12:d="none",l=this.createAttLine({color:1,style:e%5+1,width:1,std:!1});break;case 13:d="none",l=this.lineatt}const g=((e,i,n,r,s)=>{let o,h,l,d,g="";for(let c=n;c<=r;++c){if(a?(h=a(e[c],i[c]),h.x=Math.round(t.grx(h.x)),h.y=Math.round(t.gry(h.y))):h={x:Math.round(e[c]),y:Math.round(i[c])},g)if(c===r&&l&&h.x===l.x&&h.y===l.y){if(!d)return"";g+="z",s=!1}else h.x!==o.x&&h.y!==o.y?(g+=`l${h.x-o.x},${h.y-o.y}`,d=!0):h.x!==o.x?(g+="h"+(h.x-o.x),d=!0):h.y!==o.y&&(g+="v"+(h.y-o.y),d=!0);else g=`M${h.x},${h.y}`,l=h;o=h}return s&&(g+="z"),g})(i,n,r,o,"none"!==d);if(!g)return;const c=this.draw_g.append("svg:path").attr("d",g).style("fill",d);l&&c.call(l.func)})),n.hide_only_zeros=!0,n}createPolyBin(){return""}drawBinsText(t){null===t&&(t=this.prepareDraw({rounding:!1}));const e=this.getHisto(),i=this.v7EvalFont("text",{size:20,color:"black",align:22}),r=this.options.BarOffset||0,o=this.draw_g.append("svg:g").attr("class","th2_text"),a=t.stepi,h=t.stepj;let l,d,g,c,x,p,m,u,f,y;for(this.startTextDrawing(i,"font",o),l=t.i1;l<t.i2;l+=a)for(d=t.j1;d<t.j2;d+=h)g=e.getBinContent(l+1,d+1),(0!==g||this._show_empty_bins)&&(c=t.grx[l+a]-t.grx[l],x=t.gry[d]-t.gry[d+h],p=g===Math.round(g)?g.toString():(0,s.lg)(g,n.gStyle.fPaintTextFormat),i.angle?(m=Math.round(t.grx[l]+.5*c),u=Math.round(t.gry[d+h]+x*(.5+r)),f=y=0):(m=Math.round(t.grx[l]+.1*c),u=Math.round(t.gry[d+h]+x*(.1+r)),f=Math.round(.8*c),y=Math.round(.8*x)),this.drawText({align:22,x:m,y:u,width:f,height:y,text:p,latex:0,draw_g:o}));return this.finishTextDrawing(o,!0).then((()=>(t.hide_only_zeros=!0,t)))}drawBinsArrow(){const t=this.getHisto(),e=this.prepareDraw({rounding:!1}),i=(e.grx[e.i2]-e.grx[e.i1])/(e.i2-e.i1+1-.03)/2,n=(e.gry[e.j2]-e.gry[e.j1])/(e.j2-e.j1+1-.03)/2,r=e.stepi,s=e.stepj,o=(t,e)=>t?e?`l${t},${e}`:`h${t}`:e?`v${e}`:"";let a,h,l,d,g,c,x,p,m,u,f,y,w,M,b,_="",C=1e-30;for(let $=0;$<2;++$)for(a=e.i1;a<e.i2;a+=r)for(h=e.j1;h<e.j2;h+=s)l=a===e.i1?t.getBinContent(a+1+r,h+1)-t.getBinContent(a+1,h+1):a>=e.i2-r?t.getBinContent(a+1,h+1)-t.getBinContent(a+1-r,h+1):.5*(t.getBinContent(a+1+r,h+1)-t.getBinContent(a+1-r,h+1)),d=h===e.j1?t.getBinContent(a+1,h+1+s)-t.getBinContent(a+1,h+1):h>=e.j2-s?t.getBinContent(a+1,h+1)-t.getBinContent(a+1,h+1-s):.5*(t.getBinContent(a+1,h+1+s)-t.getBinContent(a+1,h+1-s)),0===$?C=Math.max(C,Math.abs(l),Math.abs(d)):(g=(e.grx[a]+e.grx[a+r])/2,c=(e.gry[h]+e.gry[h+s])/2,x=i*l/C,p=n*d/C,m=g-x,u=g+x,f=c-p,y=c+p,l=Math.round(u-m),d=Math.round(y-f),0===l&&0===d||(_+="M"+Math.round(m)+","+Math.round(f)+o(l,d),(Math.abs(l)>5||Math.abs(d)>5)&&(w=Math.sqrt(2/(l**2+d**2)),M=Math.round(w*(l+d)),b=Math.round(w*(l-d)),(M||b)&&(_+=`m${-M},${b}`+o(M,-b)+o(-b,-M)))));return this.draw_g.append("svg:path").attr("d",_).style("fill","none").call(this.lineatt.func),e}drawBinsBox(){const t=this.getHisto(),e=this.prepareDraw({rounding:!1}),i=this.getFramePainter();i.maxbin===i.minbin&&(i.maxbin=this.gmaxbin,i.minbin=this.gminbin,i.minposbin=this.gminposbin),i.maxbin===i.minbin&&(i.minbin=Math.min(0,i.maxbin-1));const n=Math.max(Math.abs(i.maxbin),Math.abs(i.minbin)),s=Math.max(0,i.minbin),o=e.stepi,a=e.stepj;let h,l,d,g,c,x,p,m,u,f,y,w,M="",b="",_="",C="",$=!1,B=0;if(i.logz&&n>0){$=!0;const t=Math.log(n);B=s>0?Math.log(s):i.minposbin>=1&&i.minposbin<100?Math.log(.7):i.minposbin>0?Math.log(.7*i.minposbin):t-10,B>=t&&(B=t-10),w=1/(t-B)}else w=1/(n-s);for(h=e.i1;h<e.i2;h+=o)for(l=e.j1;l<e.j2;l+=a)if(d=t.getBinContent(h+1,l+1),g=Math.abs(d),!(0===g||g<s)&&(c=$?g>0?Math.log(g)-B:0:g-s,c=.5*(c<0?1:1-Math.sqrt(c*w)),c<0&&(c=0),f=e.grx[h+o]-e.grx[h],y=e.gry[l]-e.gry[l+a],x=c*f,p=c*y,m=Math.round(e.grx[h]+x),u=Math.round(e.gry[l+a]+p),f=Math.max(Math.round(f-2*x),1),y=Math.max(Math.round(y-2*p),1),M+=`M${m},${u}v${y}h${f}v${-y}z`,d<0&&10===this.options.BoxStyle&&(b+=`M${m},${u}l${f},${y}M${m+f},${u}l${-f},${y}`),11===this.options.BoxStyle&&f>5&&y>5)){const t=Math.round(.1*f),e=Math.round(.1*y),i=`M${m},${u}h${f}l${-t},${e}h${2*t-f}v${y-2*e}l${-t},${e}z`,n=`M${m+f},${u+y}v${-y}l${-t},${e}v${y-2*e}h${2*t-f}l${-t},${e}z`;C+=d<0?i:n,_+=d<0?n:i}if(M){const t=this.draw_g.append("svg:path").attr("d",M).call(this.fillatt.func);11!==this.options.BoxStyle&&this.fillatt.empty()&&t.call(this.lineatt.func)}if(_&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",_).call(this.fillatt.func).style("fill",(0,r.Qh)(this.fillatt.color).brighter(.5).formatHex()),C&&this.draw_g.append("svg:path").attr("d",C).call(this.fillatt.func).style("fill",this.fillatt.hasColor()?(0,r.Qh)(this.fillatt.color).darker(.5).formatHex():"red"),b){const t=this.draw_g.append("svg:path").attr("d",b).style("fill","none");this.lineatt.empty()||t.call(this.lineatt.func)}return e}drawBinsScatter(){const t=this.getHisto(),e=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),i=[],n=[],r=[],o=[],a=[],h=this.options.ScatCoef*(this.gmaxbin>2e3?2e3/this.gmaxbin:1),l=e.stepi,d=e.stepj,g=new s.YF(e.sumz);let c,x,p,m,u,f,y,w,M=1;if(h*e.sumz<1e5){this.createv7AttMarker(),this.markeratt.resetPos();let i,n,r="";for(m=e.i1;m<e.i2;m+=l)for(y=e.grx[m+l]-e.grx[m],u=e.j1;u<e.j2;u+=d)if(w=e.gry[u]-e.gry[u+d],f=t.getBinContent(m+1,u+1),n=Math.round(h*f),!(n<=0))for(i=0;i<n;++i)r+=this.markeratt.create(Math.round(e.grx[m]+y*g.random()),Math.round(e.gry[u+1]+w*g.random()));return this.draw_g.append("svg:path").attr("d",r).call(this.markeratt.func),e}for(this.maxbin>.7&&(M=.7/this.maxbin),m=e.i1;m<e.i2;m+=l)for(u=e.j1;u<e.j2;u+=d)f=t.getBinContent(m+1,u+1),f<=0||f<this.minbin||(y=e.grx[m+l]-e.grx[m],w=e.gry[u]-e.gry[u+d],y*w<=0||(c=e.palette.getContourIndex(f/y/w),c<0||(x=`M${e.grx[m]},${e.gry[u+d]}`,void 0===i[c]?(i[c]=x,o[c]=y,a[c]=w):(p=`m${e.grx[m]-n[c]},${e.gry[u+d]-r[c]}`,i[c]+=p.length<x.length?p:x,o[c]=Math.max(o[c],y),a[c]=Math.max(a[c],w)),n[c]=e.grx[m],r[c]=e.gry[u+d],i[c]+=`v${w}h${y}v${-w}z`)));const b=this.getFrameSvg().selectChild(".main_layer");let _=b.selectChild("def");_.empty()&&i.length>0&&(_=b.insert("svg:defs",":first-child")),this.createv7AttMarker();const C=e.palette.getContour();for(c=0;c<i.length;++c)if(void 0!==i[c]&&c<C.length){const t=(this.pad_name||"canv")+`_scatter_${c}`;let e=_.selectChild(`#${t}`);e.empty()?e=_.append("svg:pattern").attr("id",t).attr("patternUnits","userSpaceOnUse"):e.selectAll("*").remove();let n=Math.round(M*C[c]*o[c]*a[c]);n<1&&(n=1);const r=new Float32Array(n),s=new Float32Array(n);if(1===n)r[0]=s[0]=.5;else for(let i=0;i<n;++i)r[i]=g.random(),s[i]=g.random();this.markeratt.resetPos();let h="";for(let i=0;i<n;++i)h+=this.markeratt.create(r[i]*o[c],s[i]*a[c]);e.attr("width",o[c]).attr("height",a[c]).append("svg:path").attr("d",h).call(this.markeratt.func),this.draw_g.append("svg:path").attr("scatter-index",c).style("fill",`url(#${t})`).attr("d",i[c])}return e}async draw2DBins(){if(!this.draw_content)return this.removeG(),!1;this.createHistDrawAttributes(),this.createG(!0);const t=this.getFramePainter(),e=t.getFrameRect(),i=t.getGrFuncs(this.options.second_x,this.options.second_y);let n=null,r=null;return this.options.Scat?n=this.drawBinsScatter():this.options.Color?n=this.drawBinsColor():this.options.Box?n=this.drawBinsBox():this.options.Arrow?n=this.drawBinsArrow():this.options.Contour>0&&(n=this.drawBinsContour(i,e.width,e.height)),this.options.Text&&(r=this.drawBinsText(n)),n||r||(n=this.drawBinsColor()),r||(r=Promise.resolve(n)),r.then((t=>(this.tt_handle=t,this)))}getBinTooltips(t,e){const i=[],r=this.getHisto();let o=r.getBinContent(t+1,e+1),a=1,h=1;this.isDisplayItem()&&(a=r.stepx||1,h=r.stepy||1),i.push(this.getObjectHint()||"histo<2>","x = "+this.getAxisBinTip("x",t,a),"y = "+this.getAxisBinTip("y",e,h),`bin = ${t+1}, ${e+1}`),r.$baseh&&(o-=r.$baseh.getBinContent(t+1,e+1));const l="entries = "+(a>1||h>1?"~":"");return o===Math.round(o)?i.push(l+o):i.push(l+(0,s.lg)(o,n.gStyle.fStatFormat)),i}getPolyBinTooltips(){return[]}processTooltipEvent(t){const e=this.getHisto(),i=this.tt_handle;let n=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_content||!this.draw_g||!i||this.options.Proj)return n?.remove(),null;if(i.poly)return null;let r,o,a=0,h=null;for(r=i.i1;r<i.i2&&!(t.x>=i.grx[r]&&t.x<=i.grx[r+1]);++r);for(o=i.j1;o<i.j2&&!(t.y>=i.gry[o+1]&&t.y<=i.gry[o]);++o);if(r<i.i2&&o<i.j2&&(a=e.getBinContent(r+1,o+1),this.is_projection?h=0:i.hide_only_zeros?h=0!==a||this._show_empty_bins?0:null:(h=i.palette.getContourIndex(a),null===h&&0===a&&this._show_empty_bins&&(h=0))),null===h)return n.remove(),null;const l={name:"histo",title:e.fTitle||"title",x:t.x,y:t.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(r,o),exact:!0,menu:!0};if(this.options.Color&&(l.color2=i.palette.getColor(h)),t.disabled&&!this.is_projection)n.remove(),l.changed=!0;else{n.empty()&&(n=this.draw_g.append("svg:path").attr("class","tooltip_bin").style("pointer-events","none").call(s.Ru));const t=this.getFramePainter();let e,a=r,h=r+1,d=o,g=o+1,c=i.grx[a],x=i.grx[h],p=i.gry[g],m=i.gry[d],u=1e4*r+o;if(this.is_projection){const t=this.projection_widthX||1,e=(t-1)/2;this.is_projection.indexOf("X")>=0&&t>1&&(g+e>=i.j2?(g=Math.min(Math.round(g+e),i.j2),d=Math.max(g-t,i.j1)):(d=Math.max(Math.round(d-e),i.j1),g=Math.min(d+t,i.j2)));const n=this.projection_widthY||1,r=(n-1)/2;this.is_projection.indexOf("Y")>=0&&n>1&&(h+r>=i.i2?(h=Math.min(Math.round(h+r),i.i2),a=Math.max(h-n,i.i1)):(a=Math.max(Math.round(a-r),i.i1),h=Math.min(a+n,i.i2)))}"X"===this.is_projection?(c=0,x=t.getFrameWidth(),p=i.gry[g],m=i.gry[d],u=777*d+333*g):"Y"===this.is_projection?(p=0,m=t.getFrameHeight(),c=i.grx[a],x=i.grx[h],u=777*a+333*h):"XY"===this.is_projection&&(p=i.gry[g],m=i.gry[d],c=i.grx[a],x=i.grx[h],u=789*a+653*h+12345*d+654321*g,e=`M${c},0H${x}V${p}H${t.getFrameWidth()}V${m}H${x}V${t.getFrameHeight()}H${c}V${m}H0V${p}H${c}Z`),l.changed=n.property("current_bin")!==u,l.changed&&n.attr("d",e||`M${c},${p}H${x}V${m}H${c}Z`).style("opacity","0.7").property("current_bin",u),this.is_projection&&l.changed&&this.redrawProjection(a,h,d,g)}return l.changed&&(l.user_info={obj:e,name:"histo",bin:e.getBin(r+1,o+1),cont:a,binx:r+1,biny:o+1,grx:t.x,gry:t.y}),l}canZoomInside(t,e,i){if("z"===t)return!0;const n=this.getAxis(t);return n.FindBin(i,.5)-n.FindBin(e,0)>1}async draw2D(t){return this.clear3DScene(),this.drawFrameAxes().then((e=>!!e&&this.drawingBins(t))).then((t=>{if(t)return this.draw2DBins().then((()=>this.addInteractivity()))})).then((()=>this))}async draw3D(t){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),this.draw2D(t)}async callDrawFunc(t){const e=this.getFramePainter();return e&&e.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=e.mode3d),this.options.Mode3D?this.draw3D(t):this.draw2D(t)}async redraw(t){return this.callDrawFunc(t)}static async _draw(t){return(0,a.ensureRCanvas)(t).then((()=>{t.setAsMainPainter(),t.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:n.kNoZoom,maximum:n.kNoZoom,FrontBox:!1,BackBox:!1};const e=t.v7EvalAttr("kind",""),i=t.v7EvalAttr("sub",0),r=t.options;switch(r.Text=t.v7EvalAttr("drawtext",!1),e){case"lego":r.Lego=i>0?10+i:12,r.Mode3D=!0;break;case"surf":r.Surf=i>0?10+i:1,r.Mode3D=!0;break;case"box":r.Box=!0,r.BoxStyle=10+i;break;case"err":r.Error=!0,r.Mode3D=!0;break;case"cont":r.Contour=i>0?10+i:1;break;case"arr":r.Arrow=!0;break;case"scat":r.Scat=!0;break;case"col":r.Color=!0;break;default:r.Text||(r.Color=!0)}return t._show_empty_bins=!1,t.scanContent(),t.callDrawFunc()}))}static async draw(t,e,i){return l._draw(new l(t,e),i)}}var d=i(8094),g=i(227);class c extends l{draw3DBins(){if(this.draw_content){if(this.options.Surf)return(0,g.u$)(this,!0);if(this.options.Error)return(0,g.s6)(this,!0);if(this.options.Contour)return(0,g.SF)(this,!0,!0);(0,g.CS)(this,!0),this.updatePaletteDraw()}}draw3D(t){this.mode3d=!0;const e=this.getFramePainter(),i=this.isMainPainter();let r=Promise.resolve(this);if("resize"===t)return i&&e.resize3D()&&e.render3D(),r;let s=1+2*n.gStyle.fHistTopMargin;return this.zmin=e.logz?.3*this.gminposbin:this.gminbin,this.zmax=this.gmaxbin,this.options.minimum!==n.kNoZoom&&(this.zmin=this.options.minimum),this.options.maximum!==n.kNoZoom&&(this.zmax=this.options.maximum,s=1),e.logz&&this.zmin<=0&&(this.zmin=1e-5*this.zmax),this.deleteAttr(),i&&((0,g.wx)(e),r=e.create3DScene(this.options.Render3D).then((()=>{e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,null,this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,d.R,{zmult:s,zoom:n.settings.Zooming,ndim:2,draw:!0,v7:!0})}))),e.mode3d?r.then((()=>this.drawingBins(t))).then((()=>{const t=this.getFramePainter();return this.draw3DBins(),t.render3D(),t.addKeysHandler(),this})):r}static async draw(t,e,i){return c._draw(new c(t,e),i)}}}}]);
//# sourceMappingURL=4104.ba3fa2e3.chunk.js.map