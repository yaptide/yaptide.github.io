"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[5592,6914],{6914:(t,e,i)=>{i.r(e),i.d(e,{TF1Painter:()=>h,produceTAxisLogScale:()=>m,scanTF1Options:()=>l});var s=i(9490),a=i(1597),n=i(6950),r=i(4913),o=i(4978),f=i(4041);function m(t,e,i,s){let a,n;s>0?(n=Math.log(s),a=i>0?Math.log(i):n-5):(n=-10,a=-15),t.fNbins=e,t.fXbins=new Array(e+1);for(let r=0;r<=e;++r)t.fXbins[r]=Math.exp(a+r/e*(n-a));t.fXmin=Math.exp(a),t.fXmax=Math.exp(n)}function l(t){(0,s.isStr)(t)||(t="");let e=t.indexOf(";webcanv_hist"),i=!1,a=0;return e>=0&&(i=!0,t=t.slice(0,e)),e=t.indexOf(";force_saved"),e>=0&&(a=2,t=t.slice(0,e)),e=t.indexOf(";prefer_saved"),e>=0&&(a=1,t=t.slice(0,e)),{opt:t,webcanv_hist:i,use_saved:a}}class h extends o.N{getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??s.clTF1}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(t){if(!t||this.getClassName()!==t._typename)return!1;delete t.evalPar;const e=this.getHisto();if(this.webcanv_hist){const t=this.getPadPainter()?.findInPrimitives("Func",s.clTH1D);t&&this.updateAxes(e,t,this.getFramePainter())}return this.$func=t,this.createTF1Histogram(t,e),this.scanContent(),!0}redraw(t){return this._use_saved_points||"logx"!==t&&"zoom"!==t||(this.createTF1Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(t)}createTF1Histogram(t,e){const i=this.getFramePainter(),a=this.getPadPainter()?.getRootPad(!0),n=a?.fLogx,r=i?.getGrFuncs(this.second_x,this.second_y);let o=t.fXmin,l=t.fXmax,h=Math.max(t.fNpx,100);if(r?.zoom_xmin!==r?.zoom_xmax){const t=(l-o)/h;o<r.zoom_xmin&&r.zoom_xmin<l&&(o=Math.max(o,r.zoom_xmin-t)),o<r.zoom_xmax&&r.zoom_xmax<l&&(l=Math.min(l,r.zoom_xmax+t))}this._use_saved_points=t.fSave.length>3&&(s.settings.PreferSavedPoints||this.use_saved>1);const c=t=>{e.fNcells!==t+2&&(e.fNcells=t+2,e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=t,e.fXaxis.fXbins=[]};if(delete this._fail_eval,!this._use_saved_points){let i=!1;if(!t.evalPar)try{(0,f.Dx)(t)||(i=!0)}catch{i=!0}c(h),n?m(e.fXaxis,h,o,l):(e.fXaxis.fXmin=o,e.fXaxis.fXmax=l);for(let s=0;s<h&&!i;s++){const a=e.fXaxis.GetBinCenter(s+1);let n=0;try{n=t.evalPar(a)}catch(x){i=!0}i||e.setBinContent(s+1,Number.isFinite(n)?n:0)}i&&(this._fail_eval=!0),i&&t.fSave.length>3&&(this._use_saved_points=!0)}if(this._use_saved_points){h=t.fSave.length-3;let i=null;if(o=t.fSave[h+1],l=t.fSave[h+2],o===l){const t=this.getMainPainter();(0,s.isFunc)(t?.getHisto)&&(i=t?.getHisto()?.fXaxis)}if(i){c(e.fXaxis.fNbins),Object.assign(e.fXaxis,i);for(let i=0;i<h;++i){const s=t.fSave[i];e.setBinContent(i+1,Number.isFinite(s)?s:0)}}else{c(t.fNpx),e.fXaxis.fXmin=t.fXmin,e.fXaxis.fXmax=t.fXmax;for(let i=0;i<t.fNpx;++i){const s=(0,f.YI)(t,e.fXaxis.GetBinCenter(i+1));e.setBinContent(i+1,Number.isFinite(s)?s:0)}}}e.fName="Func",(0,s.setHistogramTitle)(e,t.fTitle),e.fMinimum=t.fMinimum,e.fMaximum=t.fMaximum,e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize,e.fBits|=s.kNoStats}extractAxesProperties(t){super.extractAxesProperties(t);const e=this.$func,i=e?.fSave.length??0;i>3&&this._use_saved_points&&(this.xmin=Math.min(this.xmin,e.fSave[i-2]),this.xmax=Math.max(this.xmax,e.fSave[i-1])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax))}canZoomInside(t,e,i){const s=this.$func?.fSave.length??0;if(s>3&&this._use_saved_points&&"x"===t){const t=s-2,a=this.$func.fSave[s-2],n=this.$func.fSave[s-1];return Math.abs(n-a)/t<Math.abs(i-e)}return"x"===t||"y"===t}getTF1Tooltips(t){delete this.$tmp_tooltip;const e=[this.getObjectHint()],i=this.getFramePainter()?.getGrFuncs(this.options.second_x,this.options.second_y);if(!i||!(0,s.isFunc)(this.$func?.evalPar))return e.push("grx = "+t.x,"gry = "+t.y),e;const n=i.revertAxis("x",t.x);let r=0,o=0,f=!1;try{r=this.$func.evalPar(n),o=Math.round(i.gry(r))}catch{f=!0}return e.push("x = "+i.axisAsText("x",n),"value = "+(f?"<fail>":(0,a.lg)(r,s.gStyle.fStatFormat))),f||(this.$tmp_tooltip={y:r,gry:o}),e}processTooltipEvent(t){if(this._use_saved_points)return super.processTooltipEvent(t);let e=this.draw_g?.selectChild(".tooltip_bin");if(!this.draw_g||!t)return e?.remove(),null;const i={name:this.$func?.fName,title:this.$func?.fTitle,x:t.x,y:t.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF1Tooltips(t),exact:!0,menu:!0};return t.disabled?e.remove():(e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),e.attr("cx",t.x).attr("cy",this.$tmp_tooltip.gry??t.y).call(this.lineatt?.func)),i}fillWebObjectOptions(t){t.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static async draw(t,e,i){const a=l(i);let o;if(i=a.opt,delete a.opt,a.webcanv_hist){const e=new n.JW(t);o=e.getPadPainter()?.findInPrimitives("Func",s.clTH1D)}o||(o=(0,s.createHistogram)(s.clTH1D,100),o.fBits|=s.kNoStats),!i&&(0,n.Nn)(t)&&(i="same");const f=new h(t,o);return f.$func=e,Object.assign(f,a),f.createTF1Histogram(e,o),r.mf._drawHist(f,i)}}},5592:(t,e,i)=>{i.r(e),i.d(e,{TF3Painter:()=>h});var s=i(9490),a=i(1225),n=i(4041),r=i(6914),o=i(6950),f=i(1597),m=i(4913);function l(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let s=t.length-2;s>=0;--s){const a=e[s],n=e[s+1],r=t[s],o=t[s+1];if(a===i)return r;if(n===i)return o;if(a<i!==n<i)return r+(i-a)/(n-a)*(o-r)}return t[0]-1}class h extends a.TH2Painter{getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??s.clTF3}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(t){if(!t||this.getClassName()!==t._typename)return!1;delete t.evalPar;const e=this.getHisto();if(this.webcanv_hist){const t=this.getPadPainter()?.findInPrimitives("Func",s.clTH2F);t&&this.updateAxes(e,t,this.getFramePainter())}return this.$func=t,this.createTF3Histogram(t,e),this.scanContent(),!0}redraw(t){return this._use_saved_points||"logx"!==t&&"logy"!==t&&"logy"!==t&&"zoom"!==t||(this.createTF3Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(t)}createTF3Histogram(t,e){const i=t.fSave.length-9;this._use_saved_points=i>0&&(s.settings.PreferSavedPoints||this.use_saved>1);const a=this.getFramePainter(),o=this.getPadPainter()?.getRootPad(!0),f=o?.fLogx,m=o?.fLogy,h=a?.getGrFuncs(this.second_x,this.second_y);let c=t.fXmin,x=t.fXmax,u=t.fYmin,_=t.fYmax,d=t.fZmin,g=t.fZmax,v=Math.max(t.fNpx,20),p=Math.max(t.fNpy,20),y=Math.max(t.fNpz,20);if(h?.zoom_xmin!==h?.zoom_xmax){const t=(x-c)/v;c<h.zoom_xmin&&h.zoom_xmin<x&&(c=Math.max(c,h.zoom_xmin-t)),c<h.zoom_xmax&&h.zoom_xmax<x&&(x=Math.min(x,h.zoom_xmax+t))}if(h?.zoom_ymin!==h?.zoom_ymax){const t=(_-u)/p;u<h.zoom_ymin&&h.zoom_ymin<_&&(u=Math.max(u,h.zoom_ymin-t)),u<h.zoom_ymax&&h.zoom_ymax<_&&(_=Math.min(_,h.zoom_ymax+t))}h?.zoom_zmin!==h?.zoom_zmax&&(d<h.zoom_zmin&&h.zoom_zmin<g&&(d=h.zoom_zmin),d<h.zoom_zmax&&h.zoom_zmax<g&&(g=h.zoom_zmax));const S=(t,i)=>{e.fNcells!==(t+2)*(i+2)&&(e.fNcells=(t+2)*(i+2),e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=t,e.fXaxis.fXbins=[],e.fYaxis.fNbins=i,e.fYaxis.fXbins=[],e.fXaxis.fXmin=c,e.fXaxis.fXmax=x,e.fYaxis.fXmin=u,e.fYaxis.fXmax=_,e.fMinimum=d,e.fMaximum=g};if(delete this._fail_eval,!this._use_saved_points){let s=!1;t.evalPar||(0,n.Dx)(t)||(s=!0),S(v,p),f&&(0,r.produceTAxisLogScale)(e.fXaxis,v,c,x),m&&(0,r.produceTAxisLogScale)(e.fYaxis,p,u,_);const a=new Array(y),o=new Array(y);for(let t=0;t<y;++t)o[t]=d+t/(y-1)*(g-d);for(let i=0;i<p&&!s;++i)for(let n=0;n<v&&!s;++n){const r=e.fXaxis.GetBinCenter(n+1),f=e.fYaxis.GetBinCenter(i+1);let m=0;try{for(let e=0;e<y;++e)a[e]=t.evalPar(r,f,o[e]);m=l(o,a)}catch{s=!0}s||e.setBinContent(e.getBin(n+1,i+1),Number.isFinite(m)?m:0)}s&&(this._fail_eval=!0),s&&i>0&&(this._use_saved_points=!0)}if(this._use_saved_points){c=t.fSave[i],x=t.fSave[i+1],u=t.fSave[i+2],_=t.fSave[i+3],d=t.fSave[i+4],g=t.fSave[i+5],v=Math.round(t.fSave[i+6]),p=Math.round(t.fSave[i+7]),y=Math.round(t.fSave[i+8]);const s=(g-d)/y;S(v+1,p+1);const a=new Array(y+1),n=new Array(y+1);for(let t=0;t<=y;t++)n[t]=d+t*s;for(let i=0;i<=v;++i)for(let s=0;s<=p;++s){for(let e=0;e<=y;e++)a[e]=t.fSave[i+(v+1)*(s+(p+1)*e)];const r=l(n,a);e.setBinContent(e.getBin(i+1,s+1),Number.isFinite(r)?r:0)}}return e.fName="Func",(0,s.setHistogramTitle)(e,t.fTitle),e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize,e.fBits|=s.kNoStats,e}extractAxesProperties(t){super.extractAxesProperties(t);const e=this.$func,i=e?.fSave.length??0;i>9&&this._use_saved_points&&(this.xmin=Math.min(this.xmin,e.fSave[i-9]),this.xmax=Math.max(this.xmax,e.fSave[i-8]),this.ymin=Math.min(this.ymin,e.fSave[i-7]),this.ymax=Math.max(this.ymax,e.fSave[i-6]),this.zmin=Math.min(this.zmin,e.fSave[i-5]),this.zmax=Math.max(this.zmax,e.fSave[i-4])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax),this.ymin=Math.min(this.ymin,e.fYmin),this.ymax=Math.max(this.ymax,e.fYmax),this.zmin=Math.min(this.zmin,e.fZmin),this.zmax=Math.max(this.zmax,e.fZmax))}fillWebObjectOptions(t){t.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static async draw(t,e,i){const a=(0,r.scanTF1Options)(i);i=a.opt,delete a.opt;const n=new f.nC(i);let l;if(n.empty()||"gl"===i?i="surf1":"SAME"===n.opt&&(i="surf1 same"),0!==i.indexOf("same")&&0!==i.indexOf("SAME")||(0,o.Nn)(t)||(i="A_ADJUST_FRAME_"+i.slice(4)),a.webcanv_hist){const e=new o.JW(t);l=e.getPadPainter()?.findInPrimitives("Func",s.clTH2F)}l||(l=(0,s.createHistogram)(s.clTH2F,20,20),l.fBits|=s.kNoStats);const c=new h(t,l);return c.$func=e,Object.assign(c,a),c.createTF3Histogram(e,l),m.mf._drawHist(c,i)}}}}]);
//# sourceMappingURL=5592.7ff44290.chunk.js.map