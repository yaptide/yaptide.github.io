"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[3476],{3476:(t,e,n)=>{n.r(e),n.d(e,{RH3Painter:()=>c,drawHistDisplayItem:()=>f});var i=n(9490),s=n(881),o=n(1597),r=n(4709),a=n(8094),h=n(7663),g=n(273),l=n(1655),x=n(4104),d=n(227);class c extends h.G{getDimension(){return 3}scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;const e=this.getHisto();if(e){if(this.extractAxesProperties(3),this.isDisplayItem())this.gminbin=e.fContMin,this.gminposbin=e.fContMinPos>0?e.fContMinPos:null,this.gmaxbin=e.fContMax;else{this.gminbin=this.gmaxbin=e.getBinContent(1,1,1);for(let t=0;t<this.nbinsx;++t)for(let n=0;n<this.nbinsy;++n)for(let i=0;i<this.nbinsz;++i){const s=e.getBinContent(t+1,n+1,i+1);s<this.gminbin?this.gminbin=s:s>this.gmaxbin&&(this.gmaxbin=s)}}this.draw_content=0!==this.gmaxbin||0!==this.gminbin}}countStat(){const t=this.getHisto(),e=this.getAxis("x"),n=this.getAxis("y"),i=this.getAxis("z"),s=this.getSelectIndex("x","left"),o=this.getSelectIndex("x","right"),r=this.getSelectIndex("y","left"),a=this.getSelectIndex("y","right"),h=this.getSelectIndex("z","left"),g=this.getSelectIndex("z","right"),l={name:t.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};let x,d,c,f,m,u,w,p,y,b,B=0,A=0,z=0,C=0,M=0,S=0,D=0;for(x=1;x<=this.nbinsx;++x)for(f=e.GetBinCoord(x-.5),m=x<=s+1?0:x>o+1?2:1,d=1;d<=this.nbinsy;++d)for(u=n.GetBinCoord(d-.5),w=d<=r+1?0:d>a+1?2:1,c=1;c<=this.nbinsz;++c)p=i.GetBinCoord(c-.5),y=c<=h+1?0:c>g+1?2:1,b=t.getBinContent(x,d,c),l.entries+=b,1===m&&1===w&&1===y&&(B+=b,A+=f*b,z+=u*b,C+=p*b,M+=f**2*b,S+=u**2*b,D+=p**2*b);return Math.abs(B)>1e-300&&(l.meanx=A/B,l.meany=z/B,l.meanz=C/B,l.rmsx=Math.sqrt(Math.abs(M/B-l.meanx**2)),l.rmsy=Math.sqrt(Math.abs(S/B-l.meany**2)),l.rmsz=Math.sqrt(Math.abs(D/B-l.meanz**2))),l.integral=B,t.fEntries>1&&(l.entries=t.fEntries),l}fillStatistic(t,e){const n=this.countStat(),i=e%10,s=Math.floor(e/10)%10,o=Math.floor(e/100)%10,r=Math.floor(e/1e3)%10,a=Math.floor(e/1e6)%10;return t.clearStat(),i>0&&t.addText(n.name),s>0&&t.addText("Entries = "+t.format(n.entries,"entries")),o>0&&(t.addText("Mean x = "+t.format(n.meanx)),t.addText("Mean y = "+t.format(n.meany)),t.addText("Mean z = "+t.format(n.meanz))),r>0&&(t.addText("Std Dev x = "+t.format(n.rmsx)),t.addText("Std Dev y = "+t.format(n.rmsy)),t.addText("Std Dev z = "+t.format(n.rmsz))),a>0&&t.addText("Integral = "+t.format(n.integral,"entries")),!0}getBinTooltips(t,e,n){const s=[],r=this.getHisto();let a=1,h=1,g=1;this.isDisplayItem()&&(a=r.stepx||1,h=r.stepy||1,g=r.stepz||1),s.push(this.getObjectHint(),`x = ${this.getAxisBinTip("x",t,a)}  xbin=${t+1}`,`y = ${this.getAxisBinTip("y",e,h)}  ybin=${e+1}`,`z = ${this.getAxisBinTip("z",n,g)}  zbin=${n+1}`);const l=r.getBinContent(t+1,e+1,n+1),x="entries = "+(a>1||h>1||g>1?"~":"");return l===Math.round(l)?s.push(x+l):s.push(x+(0,o.lg)(l,i.gStyle.fStatFormat)),s}async draw3DScatter(t){const e=this.getHisto(),n=this.getFramePainter(),i=t.i1,s=t.i2,r=t.stepi,a=t.j1,h=t.j2,l=t.stepj,x=t.k1,d=t.k2,c=t.stepk;if(s<=i||h<=a||d<=x)return!0;const f=this.gmaxbin>1e3?1e3/this.gmaxbin:1,m=Math.max(0,this.gminbin);let u,w,p,y,b=0,B=0;for(u=i;u<s;u+=r)for(w=a;w<h;w+=l)for(p=x;p<d;p+=c)y=e.getBinContent(u+1,w+1,p+1),B+=y,y<=m||(b+=Math.round(y*f));if(b>(n.webgl?1e5:3e4))return!1;const A=new g._l(b,n.webgl,n.size_x3d/200),z=new Int32Array(b),C=this.getAxis("x"),M=this.getAxis("y"),S=this.getAxis("z"),D=new o.YF(B);let G=0;for(u=i;u<s;u+=r)for(w=a;w<h;w+=l)for(p=x;p<d;p+=c){if(y=e.getBinContent(u+1,w+1,p+1),y<=m)continue;const t=Math.round(y*f);for(let i=0;i<t;++i){const t=C.GetBinCoord(u+D.random()),i=M.GetBinCoord(w+D.random()),s=S.GetBinCoord(p+D.random());z[G++]=e.getBin(u+1,w+1,p+1),A.addPoint(n.grx(t),n.gry(i),n.grz(s))}}return A.createPoints({color:this.v7EvalColor("fill_color","red")}).then((t=>(n.add3DMesh(t),t.bins=z,t.painter=this,t.tip_color=65280,t.tooltip=function(t){const e=Math.floor(t.index/this.nvertex);if(e<0||e>=this.bins.length)return null;const n=this.painter,i=n.getFramePainter(),s=n.get3DToolTip(this.bins[e]);return s.x1=i.grx(n.getAxis("x").GetBinLowEdge(s.ix)),s.x2=i.grx(n.getAxis("x").GetBinLowEdge(s.ix+r)),s.y1=i.gry(n.getAxis("y").GetBinLowEdge(s.iy)),s.y2=i.gry(n.getAxis("y").GetBinLowEdge(s.iy+l)),s.z1=i.grz(n.getAxis("z").GetBinLowEdge(s.iz)),s.z2=i.grz(n.getAxis("z").GetBinLowEdge(s.iz+c)),s.color=this.tip_color,s.opacity=.3,s},!0)))}draw3DBins(t){const e=this.getFramePainter();let n,i,o=this.v7EvalColor("fill_color","red"),r=0,a=!1,h=!1,l=!1,x=1,d=!0,c=.5;if(this.options.Sphere){c=.4,a=!0,11===this.options.Sphere&&(l=!0);const t=e.webgl?new s.Gu$(.5,16,12):new s.Gu$(.5,8,6);t.applyMatrix4((new s.kn4).makeRotationX(Math.PI/2)),t.computeVertexNormals();const o=t.getIndex().array,h=t.getAttribute("position").array,g=t.getAttribute("normal").array;r=3*o.length,n=new Float32Array(r),i=new Float32Array(r);for(let e=0;e<o.length;++e){const t=3*o[e];n[3*e]=h[t],n[3*e+1]=h[t+1],n[3*e+2]=h[t+2],i[3*e]=g[t],i[3*e+1]=g[t+1],i[3*e+2]=g[t+2]}}else{const t=g.DJ.Indexes,e=g.DJ.Normals,s=g.DJ.Vertices;r=3*t.length,n=new Float32Array(r),i=new Float32Array(r);for(let o=0,r=-3;o<t.length;++o){const a=s[t[o]];n[3*o]=a.x-.5,n[3*o+1]=a.y-.5,n[3*o+2]=a.z-.5,o%6===0&&(r+=3),i[3*o]=e[r],i[3*o+1]=e[r+1],i[3*o+2]=e[r+2]}h=!0,11===this.options.Box?l=!0:12===this.options.Box?(l=!0,h=!1):this.options.Color&&(l=!0,x=.5,d=!1,h=!1,a=!0)}d&&(d=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);const f=this.getHisto(),m=t.i1,u=t.i2,w=t.stepi,p=t.j1,y=t.j2,b=t.stepj,B=t.k1,A=t.k2,z=t.stepk;let C=null;if(l&&(C=e.getHistPalette(),this.createContour(e,C)),u<=m||y<=p||A<=B)return!0;const M=[];let S,D,G,I,v,E=0,_=0,P=[];for(S=m;S<u;S+=w)for(D=p;D<y;D+=b)for(G=B;G<A;G+=z){if(v=f.getBinContent(S+1,D+1,G+1),!this.options.Color&&(0===v||v<this.gminbin))continue;if(I=d?Math.pow(Math.abs(v*d),.3333):1,I<.001)continue;if(E++,!l)continue;const t=C.getContourIndex(v);t>=0?(void 0===M[t]&&(M[t]=0,P[t]=_++),M[t]+=1):console.error(`not found color for value = ${v}`)}l||(M.push(E),_=1,P=[0]);const T=new Array(_),k=new Array(_),F=new Array(_),L=new Array(_),H=new Array(_),j=new Array(_),R=new Array(_);for(let s=0;s<M.length;++s){if(!M[s])continue;E=M[s];const t=P[s];T[t]=0,H[t]=0,h&&(H[t]=E*r/3>65520?2:1),k[t]=new Float32Array(E*r),F[t]=new Float32Array(E*r),L[t]=new Int32Array(E),1===H[t]&&(j[t]=new Uint16Array(E*g.DJ.MeshSegments.length)),2===H[t]&&(R[t]=new Float32Array(E*g.DJ.Segments.length*3))}const $=this.getAxis("x"),J=this.getAxis("y"),Z=this.getAxis("z");let N,O,V,q,U,Y;for(S=m;S<u;S+=w)for(N=e.grx($.GetBinLowEdge(S+1)),O=e.grx($.GetBinLowEdge(S+2)),D=p;D<y;D+=b)for(V=e.gry(J.GetBinLowEdge(D+1)),q=e.gry(J.GetBinLowEdge(D+2)),G=B;G<A;G+=z){if(v=f.getBinContent(S+1,D+1,G+1),!this.options.Color&&(0===v||v<this.gminbin))continue;if(I=d?Math.pow(Math.abs(v*d),.3333):1,I<.001)continue;let t=0;if(l){const e=C.getContourIndex(v);if(e<0)continue;t=P[e]}E=T[t],U=e.grz(Z.GetBinLowEdge(G+1)),Y=e.grz(Z.GetBinLowEdge(G+2)),L[t][E]=f.getBin(S+1,D+1,G+1);let s=E*r;const o=k[t],a=F[t];for(let e=0;e<r;e+=3,s+=3)o[s]=(O+N)/2+n[e]*(O-N)*I,o[s+1]=(q+V)/2+n[e+1]*(q-V)*I,o[s+2]=(Y+U)/2+n[e+2]*(Y-U)*I,a[s]=i[e],a[s+1]=i[e+1],a[s+2]=i[e+2];if(1===H[t]){const e=g.DJ.MeshSegments;s=E*e.length;const n=Math.round(E*r/3),i=j[t];for(let t=0;t<e.length;++t)i[s+t]=n+e[t]}if(2===H[t]){const e=g.DJ.Segments,n=R[t];s=E*e.length*3;for(let t=0;t<e.length;++t,s+=3){const i=g.DJ.Vertices[e[t]];n[s]=(O+N)/2+(i.x-.5)*(O-N)*I,n[s+1]=(q+V)/2+(i.y-.5)*(q-V)*I,n[s+2]=(Y+U)/2+(i.z-.5)*(Y-U)*I}}T[t]=E+1}for(let X=0;X<M.length;++X){if(!M[X])continue;const t=P[X],n=new s.LoY;n.setAttribute("position",new s.THS(k[t],3)),n.setAttribute("normal",new s.THS(F[t],3)),l&&(o=C.getColor(X));const i=a?new s.G_z({color:o,opacity:x,transparent:x<1,vertexColors:!1}):new s.V9B({color:o,opacity:x,transparent:x<1,vertexColors:!1}),h=new s.eaF(n,i);if(h.bins=L[t],h.bins_faces=r/9,h.painter=this,h.tipscale=c,h.tip_color=65280,h.use_scale=d,h.tooltip=function(t){const e=Math.floor(t.faceIndex/this.bins_faces);if(e<0||e>=this.bins.length)return null;const n=this.painter,i=n.getFramePainter(),s=n.get3DToolTip(this.bins[e]),o=i.grx($.GetBinCoord(s.ix-1)),r=i.grx($.GetBinCoord(s.ix)),a=i.gry(J.GetBinCoord(s.iy-1)),h=i.gry(J.GetBinCoord(s.iy)),g=i.grz(Z.GetBinCoord(s.iz-1)),l=i.grz(Z.GetBinCoord(s.iz)),x=(this.use_scale?Math.pow(Math.abs(s.value*this.use_scale),.3333):1)*this.tipscale;return s.x1=(r+o)/2-(r-o)*x,s.x2=(r+o)/2+(r-o)*x,s.y1=(h+a)/2-(h-a)*x,s.y2=(h+a)/2+(h-a)*x,s.z1=(l+g)/2-(l-g)*x,s.z2=(l+g)/2+(l-g)*x,s.color=this.tip_color,s},e.add3DMesh(h),H[t]>0){const n=this.v7EvalColor("line_color","lightblue"),i=new s.mrM({color:n}),o=1===H[t]?(0,g.Fc)(k[t],i,j[t]):(0,g.Fc)(R[t],i);e.add3DMesh(o)}}l&&this.updatePaletteDraw()}draw3D(){if(!this.draw_content)return!1;const t=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});return(this.options.Scatter?this.draw3DScatter(t):Promise.resolve(!1)).then((e=>e||this.draw3DBins(t)))}redraw(t){const e=this.getFramePainter();return"resize"===t?(e.resize3D()&&e.render3D(),this):((0,d.wx)(e),e.create3DScene(this.options.Render3D).then((()=>(e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,a.R,{zoom:i.settings.Zooming,ndim:3,draw:!0,v7:!0}),this.drawingBins(t)))).then((()=>this.draw3D())).then((()=>(e.render3D(),e.addKeysHandler(),this))))}fillToolbar(){const t=this.getPadPainter();t&&(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,e,n){let i=this.getHisto();return i&&(i=i["f"+t.toUpperCase()+"axis"]),!i||i.FindBin(n,.5)-i.FindBin(e,0)>1}autoZoom(){const t=this.getSelectIndex("x","left"),e=this.getSelectIndex("x","right"),n=this.getSelectIndex("y","left"),i=this.getSelectIndex("y","right"),s=this.getSelectIndex("z","left"),o=this.getSelectIndex("z","right"),r=this.getHisto();let a,h,g;if(t===e||n===i||s===o)return;let l=r.getBinContent(t+1,n+1,s+1);for(a=t;a<e;++a)for(h=n;h<i;++h)for(g=s;g<o;++g)l=Math.min(l,r.getBinContent(a+1,h+1,g+1));if(l>0)return;let x=e,d=t,c=i,f=n,m=o,u=s;for(a=t;a<e;++a)for(h=n;h<i;++h)for(g=s;g<o;++g)r.getBinContent(a+1,h+1,g+1)>l&&(a<x&&(x=a),a>=d&&(d=a+1),h<c&&(c=h),h>=f&&(f=h+1),g<m&&(m=g),g>=u&&(u=g+1));let w,p,y,b,B,A,z=!1;return x===d-1&&x>t+1&&d<e-1&&(x--,d++),c===f-1&&c>n+1&&f<i-1&&(c--,f++),m===u-1&&m>s+1&&u<o-1&&(m--,u++),(x>t||d<e)&&x<d-1&&(w=this.getAxis("x").GetBinLowEdge(x+1),p=this.getAxis("x").GetBinLowEdge(d+1),z=!0),(c>n||f<i)&&c<f-1&&(y=this.getAxis("y").GetBinLowEdge(c+1),b=this.getAxis("y").GetBinLowEdge(f+1),z=!0),(m>s||u<o)&&m<u-1&&(B=this.getAxis("z").GetBinLowEdge(m+1),A=this.getAxis("z").GetBinLowEdge(u+1),z=!0),z?this.getFramePainter().zoom(w,p,y,b,B,A):void 0}fillHistContextMenu(t){const e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if(0===t.indexOf(i.kInspect))return this.showInspector(t);this.decodeOptions(t),this.interactiveRedraw(!0,"drawopt")}))}static async draw(t,e){const n=new c(t,e);return n.mode3d=!0,(0,r.ensureRCanvas)(n,"3d").then((()=>{n.setAsMainPainter(),n.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:i.kNoZoom,maximum:i.kNoZoom,FrontBox:!1,BackBox:!1};const t=n.v7EvalAttr("kind",""),e=n.v7EvalAttr("sub",0),s=n.options;switch(t){case"box":s.Box=10+e;break;case"sphere":s.Sphere=10+e;break;case"col":s.Color=!0;break;case"scat":s.Scatter=!0;break;default:s.Box=10}return n.scanContent(),n.redraw()}))}}function f(t,e,n){return e?1===e.fAxes.length?l.RH1Painter.draw(t,e,n):2===e.fAxes.length?x.RH2Painter.draw(t,e,n):3===e.fAxes.length?c.draw(t,e,n):null:null}}}]);
//# sourceMappingURL=3476.75854586.chunk.js.map