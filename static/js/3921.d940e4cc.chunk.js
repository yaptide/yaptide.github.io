"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[3921],{3921:(t,i,e)=>{e.r(i),e.d(i,{TGraphPainter:()=>y,clTGraphAsymmErrors:()=>f});var s=e(9490),r=e(8260),n=e(1597),a=e(6950),h=e(4913),o=e(4978),l=e(4435),c=e(9726),d=e(3558);const x=(0,s.BIT)(18),g="TGraphErrors",f="TGraphAsymmErrors",p="TGraphBentErrors",m="TGraphMultiErrors";class y extends a.JW{constructor(t,i){super(t,i),this.axes_draw=!1,this.bins=null,this.xmin=this.ymin=this.xmax=this.ymax=0,this.wheel_zoomy=!0,this.is_bent=i._typename===p,this.has_errors=i._typename===g||i._typename===m||i._typename===f||this.is_bent||i._typename.match(/^RooHist/)}getGraph(){return this.getObject()}getHistogram(){return this.getObject()?.fHistogram}setHistogram(t){const i=this.getObject();i&&(i.fHistogram=t)}async redraw(){let t=Promise.resolve(!0);if(this.$redraw_hist){delete this.$redraw_hist;const i=this.getMainPainter();i?.isSecondary(this)&&this.axes_draw&&(t=i.redraw())}return t.then((()=>this.drawGraph())).then((()=>{const t=this._funcHandler?.drawNext(0)??this;return delete this._funcHandler,t}))}cleanup(){delete this.interactive_bin,delete this.bins,super.cleanup()}get_gme(){const t=this.getGraph();return t?._typename===m?t:null}decodeOptions(t,i){(0,s.isStr)(t)&&0===t.indexOf("same ")&&(t=t.slice(5));const e=this.getGraph(),r=!!this.get_gme(),a=i?!!this.getMainPainter():!this.axes_draw;let h=[];this.options||(this.options={});const l=(t,i)=>{Object.assign(i,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),r&&t.check("S=",!0)&&(i.ScaleErrX=t.partAsFloat()),t.check("L")&&(i.Line=1),t.check("F")&&(i.Fill=1),t.check("CC")&&(i.Curve=2),t.check("C")&&(i.Curve=1),t.check("*")&&(i.Mark=103),t.check("P0")&&(i.Mark=104),t.check("P")&&(i.Mark=1),t.check("B")&&(i.Bar=1,i.Errors=0),t.check("Z")&&(i.Errors=1,i.Ends=0),t.check("||")&&(i.Errors=1,i.MainError=0,i.Ends=1),t.check("[]")&&(i.Errors=1,i.MainError=0,i.Ends=2),t.check("|>")&&(i.Errors=1,i.Ends=3),t.check(">")&&(i.Errors=1,i.Ends=4),t.check("0")&&(i.Mark=1,i.Errors=1,i.OutRange=1),t.check("1")&&1===i.Bar&&(i.Bar=2),t.check("2")&&(i.Rect=1,i.Errors=0),t.check("3")&&(i.EF=1,i.Errors=0),t.check("4")&&(i.EF=2,i.Errors=0),t.check("5")&&(i.Rect=2,i.Errors=0),t.check("X")&&(i.Errors=0)};Object.assign(this.options,{Axis:"",NoOpt:0,PadStats:!1,PadPalette:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),r&&t&&(t.indexOf(";")>0?(h=t.split(";"),t=h.shift()):t.indexOf("_")>0&&(h=t.split("_"),t=h.shift()));const c=this.options;let d=new n.nC(t),x="";if(o.c.forEach((t=>{d.check(t)&&(x+=";"+t)})),d.check("XAXIS_",!0)&&(x+=";XAXIS_"+d.part),d.check("YAXIS_",!0)&&(x+=";YAXIS_"+d.part),d.empty()&&(c.original=a?"lp":"alp",d=new n.nC(c.original)),d.check("NOOPT")&&(c.NoOpt=1),d.check("POS3D_",!0)&&(c.pos3d=d.partAsInt()-.5),d.check("PFC")&&!c._pfc&&(c._pfc=2),d.check("PLC")&&!c._plc&&(c._plc=2),d.check("PMC")&&!c._pmc&&(c._pmc=2),d.check("A")&&(c.Axis=d.check("I")?"A;":" "),d.check("X+")&&(c.Axis+="X+",c.second_x=a),d.check("Y+")&&(c.Axis+="Y+",c.second_y=a),d.check("RX")&&(c.Axis+="RX"),d.check("RY")&&(c.Axis+="RY"),r&&(c.blocks=[],c.skip_errors_x0=c.skip_errors_y0=!1,d.check("X0")&&(c.skip_errors_x0=!0),d.check("Y0")&&(c.skip_errors_y0=!0)),l(d,c),r&&d.check("S")&&(c.individual_styles=!0),void 0===c.Errors&&(c.Errors=!this.has_errors||r&&h.length?0:1),1===c.Mark&&1===e.fMarkerStyle&&(c.Mark=101),c.Line+c.Fill+c.Curve+c.Mark+c.Bar+c.EF+c.Rect+c.Errors===0&&d.empty()&&(c.Line=1),this.matchObjectType(g)){const t=e.fEX.length;let i=0;for(let s=0;s<t;++s)i=Math.max(i,e.fEX[s],e.fEY[s]);i<1e-100&&(c.Errors=0)}if(this._cutg=this.matchObjectType(s.clTCutG),this._cutg_lastsame=this._cutg&&e.fNpoints>3&&e.fX[0]===e.fX[e.fNpoints-1]&&e.fY[0]===e.fY[e.fNpoints-1],!c.Axis){const t=this.getPadPainter()?.getRootPad(!0);t&&t?.fPrimitives?.arr[0]!==this.getObject()||(c.Axis=" ")}c.Axis+=x;for(let s=0;s<h.length;++s){const t={};l(new n.nC(h[s]),t),t.skip_errors_x0=c.skip_errors_x0,t.skip_errors_y0=c.skip_errors_y0,c.blocks.push(t)}}extractGmeErrors(t){if(!this.bins)return;const i=this.getGraph();this.bins.forEach((e=>{e.eylow=i.fEyL[t][e.indx],e.eyhigh=i.fEyH[t][e.indx]}))}createBins(){const t=this.getGraph();if(!t)return;let i=0,e=t.fNpoints;this._cutg&&this._cutg_lastsame&&e--,t._typename===g?i=1:t._typename===m?i=2:(t._typename===f||t._typename===p||t._typename.match(/^RooHist/))&&(i=3),this.bins=new Array(e);for(let s=0;s<e;++s){const e=this.bins[s]={x:t.fX[s],y:t.fY[s],indx:s};switch(i){case 1:e.exlow=e.exhigh=t.fEX[s],e.eylow=e.eyhigh=t.fEY[s];break;case 2:e.exlow=t.fExL[s],e.exhigh=t.fExH[s],e.eylow=t.fEyL[0][s],e.eyhigh=t.fEyH[0][s];break;case 3:e.exlow=t.fEXlow[s],e.exhigh=t.fEXhigh[s],e.eylow=t.fEYlow[s],e.eyhigh=t.fEYhigh[s]}0===s&&(this.xmin=this.xmax=e.x,this.ymin=this.ymax=e.y),i>0?(this.xmin=Math.min(this.xmin,e.x-e.exlow,e.x+e.exhigh),this.xmax=Math.max(this.xmax,e.x-e.exlow,e.x+e.exhigh),this.ymin=Math.min(this.ymin,e.y-e.eylow,e.y+e.eyhigh),this.ymax=Math.max(this.ymax,e.y-e.eylow,e.y+e.eyhigh)):(this.xmin=Math.min(this.xmin,e.x),this.xmax=Math.max(this.xmax,e.x),this.ymin=Math.min(this.ymin,e.y),this.ymax=Math.max(this.ymax,e.y))}}getHistRangeMargin(){return.1}createHistogram(t,i){t||i||(t=i=!0);const e=this.getGraph(),r=this.xmin,n=this.getHistRangeMargin();let a=this.xmax,h=this.ymin,o=this.ymax;r>=a&&(a=r+1),h>=o&&(o=h+1);const l=(a-r)*n,c=(o-h)*n;let d=r-l,x=a+l,g=h-c,f=o+c;if(h>0&&g<=0&&(g=(1-n)*h),o<0&&f>=0&&(f=(1-n)*o),!this._not_adjust_hrange){const t=this.getPadPainter()?.getPadLog("x");d<0&&r>=0&&(d=t?r*(1-n):0),x>0&&a<=0&&(x=t?(1+n)*a:0)}const p=g,m=f;let y=this.getHistogram();return y?y.fMaximum!==s.kNoZoom&&y.fMinimum!==s.kNoZoom&&(g=y.fMinimum,f=y.fMaximum):(y=this._need_2dhist?(0,s.createHistogram)(s.clTH2I,30,30):(0,s.createHistogram)(s.clTH1I,100),y.fName=e.fName+"_h",y.fBits|=s.kNoStats,this._own_histogram=!0,this.setHistogram(y)),e.fMinimum!==s.kNoZoom&&(g=h=e.fMinimum),e.fMaximum!==s.kNoZoom&&(f=e.fMaximum),g<0&&h>=0&&(g=(1-n)*h),o<0&&f>=0&&(f=(1-n)*o),(0,s.setHistogramTitle)(y,this.getObject().fTitle),t&&!y.fXaxis.fLabels&&(y.fXaxis.fXmin=d,y.fXaxis.fXmax=x),i&&!y.fYaxis.fLabels&&(y.fYaxis.fXmin=Math.min(p,g),y.fYaxis.fXmax=Math.max(m,f),this._need_2dhist||(y.fMinimum=g,y.fMaximum=f)),y}unzoomUserRange(t,i){const e=this.getGraph();if(this._own_histogram||!e)return!1;const s=this.getHistogram();return t=t&&s&&(s.fXaxis.fXmin>this.xmin||s.fXaxis.fXmax<this.xmax),i=i&&s&&(s.fYaxis.fXmin>this.ymin||s.fYaxis.fXmax<this.ymax),!(!t&&!i)&&(this.createHistogram(t,i),this.getMainPainter()?.extractAxesProperties(1),!0)}canOptimize(){return s.settings.OptimizeDraw>0&&!this.options.NoOpt}optimizeBins(t,i){if(this.bins.length<30&&!i)return this.bins;let e=null;if((0,s.isFunc)(i))for(let s=0;s<this.bins.length;++s)i(this.bins[s],s)?e||(e=0===s?[]:this.bins.slice(0,s)):e&&e.push(this.bins[s]);if(e||(e=this.bins),t||(t=5e5),e.length<t||!this.canOptimize())return e;let r=Math.floor(e.length/t);r<2&&(r=2);const n=[];for(let s=0;s<e.length;s+=r)n.push(e[s]);return n}needDrawFunc(t,i){return i._typename===s.clTPaveStats?"stats"!==i.fName||!t.TestBit(s.kNoStats):i._typename!==s.clTF1&&i._typename!==s.clTF2||!i.TestBit((0,s.BIT)(9))}getTooltips(t){const i=[],e=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),s=this.get_gme();if(i.push(this.getObjectHint()),t&&e)if(void 0!==t.indx&&i.push("p = "+t.indx),i.push("x = "+e.axisAsText("x",t.x),"y = "+e.axisAsText("y",t.y)),s?i.push("error x = -"+e.axisAsText("x",s.fExL[t.indx])+"/+"+e.axisAsText("x",s.fExH[t.indx])):this.options.Errors&&e.x_handle.kind===a.UV&&(t.exlow||t.exhigh)&&i.push("error x = -"+e.axisAsText("x",t.exlow)+"/+"+e.axisAsText("x",t.exhigh)),s)for(let r=0;r<s.fNYErrors;++r)i.push(`error y${r} = -${e.axisAsText("y",s.fEyL[r][t.indx])}/+${e.axisAsText("y",s.fEyH[r][t.indx])}`);else(this.options.Errors||this.options.EF>0)&&e.y_handle.kind===a.UV&&(t.eylow||t.eyhigh)&&i.push("error y = -"+e.axisAsText("y",t.eylow)+"/+"+e.axisAsText("y",t.eyhigh));return i}get_main(){let t=this.getFramePainter();if(t?.grx&&t?.gry)return t;const i=this.getPadPainter(),e=i?.getPadRect()||{width:800,height:600};return t={pad_layer:!0,pad:i?.getRootPad(!0)??(0,s.create)(s.clTPad),pw:e.width,ph:e.height,fX1NDC:.1,fX2NDC:.9,fY1NDC:.1,fY2NDC:.9,getFrameWidth(){return this.pw},getFrameHeight(){return this.ph},grx(t){return(t=this.pad.fLogx?t>0?Math.log10(t):this.pad.fUxmin:(t-this.pad.fX1)/(this.pad.fX2-this.pad.fX1))*this.pw},gry(t){return(1-(t=this.pad.fLogv??this.pad.fLogy?t>0?Math.log10(t):this.pad.fUymin:(t-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)))*this.ph},revertAxis(t,i){return"x"===t?i/this.pw*(this.pad.fX2-this.pad.fX1)+this.pad.fX1:"y"===t?(1-i/this.ph)*(this.pad.fY2-this.pad.fY1)+this.pad.fY1:i},getGrFuncs(){return this}},t.pad?t:null}appendExclusion(t,i,e,s){const r=[];for(let n=e.length-1;n>=0;--n){const t=e[n],i=Math.sqrt(t.dgrx**2+t.dgry**2);i>1e-10&&(t.grx+=s*t.dgry/i,t.gry-=s*t.dgrx/i),r.push(t)}const a=(0,n.Mw)(r,{cmd:"L",line:!t});this.draw_g.append("svg:path").attr("d",i+a+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,i,e,r,a,h,o,c){const d=this.getGraph();if(!d?.fNpoints)return;let x=0,g=null;if(c&&h.excl_side&&(x=h.excl_width,h.width>0&&!i.Line&&!i.Curve&&(i.Line=1)),i.EF){g=this.optimizeBins(i.EF>1?2e4:0);for(let i=0;i<g.length;++i){const e=g[i];e.grx=t.grx(e.x),e.gry=t.gry(e.y-e.eylow)}const s=(0,n.Mw)(g,{line:i.EF<2,qubic:!0}),r=[];for(let i=g.length-1;i>=0;--i){const e=g[i];e.gry=t.gry(e.y+e.eyhigh),r.push(e)}const a=(0,n.Mw)(r,{line:i.EF<2,cmd:"L",qubic:!0}),h=e.append("svg:path").attr("d",s+a+"Z").call(o.func);o.empty()&&o.colorindx&&h.style("stroke",this.getColor(o.colorindx)),c&&(this.draw_kind="lines")}if(i.Line||i.Fill){let s="";this._cutg&&(s="Z",i.original||(i.Fill=1)),i.Fill&&(s="Z",x=0),g||(g=this.optimizeBins(0));for(let i=0;i<g.length;++i){const e=g[i];e.grx=t.grx(e.x),e.gry=t.gry(e.y)}const r=(0,n.Mw)(g,{line:!0,calc:x});x&&this.appendExclusion(!1,r,g,x);const a=e.append("svg:path").attr("d",r+s);i.Line&&a.call(h.func),i.Fill?a.call(o.func):a.style("fill","none"),c&&(this.draw_kind="lines")}if(i.Curve){let s=g;if("lines"!==this.draw_kind||!s||1===i.Curve&&s.length>2e4){s=this.optimizeBins(1===i.Curve?2e4:0);for(let i=0;i<s.length;++i){const e=s[i];e.grx=t.grx(e.x),e.gry=t.gry(e.y)}}const r=(0,n.Mw)(s,{qubic:!x});x&&this.appendExclusion(!0,r,s,x),e.append("svg:path").attr("d",r).call(h.func).style("fill","none"),c&&(this.draw_kind="lines")}let f=null;if((i.Errors||i.Rect||i.Bar)&&(g=this.optimizeBins(5e3,((e,s)=>{const n=t.grx(e.x);if(!i.Bar&&(n<0||n>r))return!0;const h=t.gry(e.y);return!i.Bar&&!i.OutRange&&(h<0||h>a)||(e.grx1=Math.round(n),e.gry1=Math.round(h),this.has_errors&&(e.grx0=Math.round(t.grx(e.x-i.ScaleErrX*e.exlow)-n),e.grx2=Math.round(t.grx(e.x+i.ScaleErrX*e.exhigh)-n),e.gry0=Math.round(t.gry(e.y-e.eylow)-h),e.gry2=Math.round(t.gry(e.y+e.eyhigh)-h),this.is_bent?(e.grdx0=Math.round(t.gry(e.y+d.fEXlowd[s])-h),e.grdx2=Math.round(t.gry(e.y+d.fEXhighd[s])-h),e.grdy0=Math.round(t.grx(e.x+d.fEYlowd[s])-n),e.grdy2=Math.round(t.grx(e.x+d.fEYhighd[s])-n)):e.grdx0=e.grdx2=e.grdy0=e.grdy2=0),!1)})),c&&(this.draw_kind="nodes"),f=e.selectAll(".grpoint").data(g).enter().append("svg:g").attr("class","grpoint").attr("transform",(t=>(0,n.bk)(t.grx1,t.gry1)))),i.Bar){let e=0,n=0;for(let t=0;t<g.length;++t)0===t?e=n=g[t].grx1:(e=Math.min(e,g[t].grx1),n=Math.max(n,g[t].grx1));if(1===g.length)g[0].width=r/4;else for(let t=0;t<g.length;++t)g[t].width=(n-e)/g.length*s.gStyle.fBarWidth;const h=Math.round(t.gry(0));let d=o;if(c){const t=this.getFramePainter(),i=t?.fillatt?.empty()?-1:t.fillatt.getFillColor();i===o.getFillColor()&&(d=this.createAttFill({color:"white"===i?l.tA:l.$q,pattern:1001,std:!1}))}f.append("svg:path").attr("d",(t=>{t.bar=!0;const e=t.width>1?Math.round(-t.width/2):0,s=t.width>1?Math.round(t.width):1;return`M${e},${1!==i.Bar?0:t.gry1>h?h-t.gry1:0}h${s}v${1!==i.Bar?a>t.gry1?a-t.gry1:0:Math.abs(h-t.gry1)}h${-s}z`})).call(d.func)}if(i.Rect&&f.filter((t=>t.exlow>0&&t.exhigh>0&&t.eylow>0&&t.eyhigh>0)).append("svg:path").attr("d",(t=>(t.rect=!0,`M${t.grx0},${t.gry0}H${t.grx2}V${t.gry2}H${t.grx0}Z`))).call(o.func).call(2===i.Rect?h.func:()=>{}),this.error_size=0,i.Errors){let t=h.width+s.gStyle.fEndErrorSize,e=0;const r=i.Ends?`m0,${t}v${-2*t}`:"",n=i.Ends?`m${t},0h${-2*t}`:"";let a=r,o=r,l=n,x=n;const g=(t,e)=>{if(!i.MainError)return`M${t},${e}`;const s="M0,0";return t?s+(e?`L${t},${e}`:`H${t}`):e?s+`V${e}`:s};switch(i.Ends){case 2:e=Math.max(h.width+1,Math.round(.66*t)),a=`m${e},${t}h${-e}v${-2*t}h${e}`,o=`m${-e},${t}h${e}v${-2*t}h${-e}`,l=`m${-t},${e}v${-e}h${2*t}v${e}`,x=`m${-t},${-e}v${e}h${2*t}v${-e}`;break;case 3:t=Math.max(t,Math.round(8*d.fMarkerSize*.66)),e=Math.max(h.width+1,Math.round(.66*t)),a=`l${e},${t}v${-2*t}l${-e},${t}`,o=`l${-e},${t}v${-2*t}l${e},${t}`,l=`l${-t},${e}h${2*t}l${-t},${-e}`,x=`l${-t},${-e}h${2*t}l${-t},${e}`;break;case 4:t=Math.max(t,Math.round(8*d.fMarkerSize*.66)),e=Math.max(h.width+1,Math.round(.66*t)),a=`l${e},${t}m0,${-2*t}l${-e},${t}`,o=`l${-e},${t}m0,${-2*t}l${e},${t}`,l=`l${-t},${e}m${2*t},0l${-t},${-e}`,x=`l${-t},${-e}m${2*t},0l${-t},${e}`}this.error_size=t,t=Math.floor((h.width-1)/2);let p=f.filter((t=>t.exlow>0||t.exhigh>0||t.eylow>0||t.eyhigh>0));(i.skip_errors_x0||i.skip_errors_y0)&&(p=p.filter((t=>(0!==t.x||!i.skip_errors_x0)&&(0!==t.y||!i.skip_errors_y0)))),!this.isBatchMode()&&s.settings.Tooltip&&c&&p.append("svg:path").style("fill","none").style("pointer-events","visibleFill").attr("d",(t=>`M${t.grx0},${t.gry0}h${t.grx2-t.grx0}v${t.gry2-t.gry0}h${t.grx0-t.grx2}z`)),p.append("svg:path").call(h.func).style("fill","none").attr("d",(i=>(i.error=!0,(i.exlow>0?g(i.grx0+t,i.grdx0)+a:"")+(i.exhigh>0?g(i.grx2-t,i.grdx2)+o:"")+(i.eylow>0?g(i.grdy0,i.gry0-t)+x:"")+(i.eyhigh>0?g(i.grdy2,i.gry2+t)+l:""))))}if(i.Mark){this.createAttMarker({attr:d,style:i.Mark-100}),this.marker_size=this.markeratt.getFullSize(),this.markeratt.resetPos();const n=!this.isBatchMode()&&s.settings.Tooltip&&(!this.markeratt.fill||this.marker_size<7)&&!f&&c,h=Math.max(5,Math.round(.7*this.marker_size)),o=1e6/(this.markeratt.getMarkerLength()+7);let l,x,p,m="",y="",u=1;g?this.canOptimize()&&g.length>1.5*o&&(u=Math.min(2,Math.round(g.length/o))):g=this.optimizeBins(o);for(let i=0;i<g.length;i+=u)l=g[i],x=t.grx(l.x),x>-this.marker_size&&x<r+this.marker_size&&(p=t.gry(l.y),p>-this.marker_size&&p<a+this.marker_size&&(m+=this.markeratt.create(x,p),n&&(y+=`M${x-h},${p-h}h${2*h}v${2*h}h${-2*h}z`)));m&&(e.append("svg:path").attr("d",m).call(this.markeratt.func),null===f&&"none"===this.draw_kind&&c&&(this.draw_kind=101===i.Mark?"path":"mark")),n&&y&&e.append("svg:path").attr("d",y).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,i){const e=Math.max(t.scale_xmin,i.fXq1),s=Math.min(t.scale_xmax,i.fXq2),r=Math.max(t.scale_ymin,i.fYq1),n=Math.min(t.scale_ymax,i.fYq2),a=(i,e,s,r)=>`M${t.grx(i)},${t.gry(e)}L${t.grx(s)},${t.gry(r)}`,h=(i.fYq2-i.fYq1)*(t.scale_xmin-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1,o=(i.fYq2-i.fYq1)*(t.scale_xmax-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1;let c="";if(h<t.scale_ymin){c=a((i.fXq2-i.fXq1)*(t.scale_ymin-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymin,e,r)}else c=a(t.scale_xmin,h,e,r);if(o>t.scale_ymax){c+=a(s,n,(i.fXq2-i.fXq1)*(t.scale_ymax-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymax)}else c+=a(s,n,t.scale_xmax,o);const d=this.createAttLine({style:1,width:1,color:l.tA,std:!1}),x=this.createAttLine({style:2,width:1,color:l.tA,std:!1});this.draw_g.append("path").attr("d",a(e,r,s,n)).call(d.func).style("fill","none"),this.draw_g.append("path").attr("d",c).call(x.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}createGraphDrawAttributes(t){const i=this.getGraph(),e=this.options;if(e._pfc>1||e._plc>1||e._pmc>1){const t=this.getPadPainter();if((0,s.isFunc)(t?.getAutoColor)){const s=t.getAutoColor(i.$num_graphs);this._auto_exec="",e._pfc>1&&(e._pfc=1,i.fFillColor=s,this._auto_exec+=`SetFillColor(${s});;`,delete this.fillatt),e._plc>1&&(e._plc=1,i.fLineColor=s,this._auto_exec+=`SetLineColor(${s});;`,delete this.lineatt),e._pmc>1&&(e._pmc=1,i.fMarkerColor=s,this._auto_exec+=`SetMarkerColor(${s});;`,delete this.markeratt)}}t?this.deleteAttr():(this.createAttLine({attr:i,can_excl:!0}),this.createAttFill({attr:i}))}drawGraph(){const t=this.get_main(),i=this.getGraph();if(!t)return;if(this.options.pos3d)return this.drawBins3D(t,i);const e=!!this.get_gme(),s=t.getGrFuncs(this.options.second_x,this.options.second_y),r=t.getFrameWidth(),n=t.getFrameHeight();this.createG(!t.pad_layer),this.createGraphDrawAttributes(),this.fillatt.used=!1,this.draw_kind="none",this.marker_size=0;const a=e?this.draw_g.append("svg:g"):this.draw_g;if(this.drawBins(s,this.options,a,r,n,this.lineatt,this.fillatt,!0),"TGraphQQ"===i._typename&&this.appendQQ(s,i),e){for(let t=0;t<i.fNYErrors;++t){let e=this.lineatt,a=this.fillatt;this.options.individual_styles&&(e=this.createAttLine({attr:i.fAttLine[t],std:!1}),a=this.createAttFill({attr:i.fAttFill[t],std:!1}));const h=this.draw_g.append("svg:g"),o=t<this.options.blocks.length?this.options.blocks[t]:this.options;this.extractGmeErrors(t),this.drawBins(s,o,h,r,n,e,a)}this.extractGmeErrors(0)}this.isBatchMode()||((0,c.X2)(this,this.testEditable()),(0,d.wh)(this))}extractTooltip(t){if(!t)return null;if("lines"===this.draw_kind||"path"===this.draw_kind||"mark"===this.draw_kind)return this.extractTooltipForPath(t);if("nodes"!==this.draw_kind)return null;const i=this.get_main(),e=i.getFrameHeight(),s=this.error_size,n=1===this.options.Bar,a=n?i.getGrFuncs(this.options.second_x,this.options.second_y):null,h=this.marker_size?Math.round(this.marker_size/2+1.5):0;let o=null,l=1e10,c=null;if(this.draw_g.selectAll(".grpoint").each((function(){const i=(0,r.Lt)(this).datum();if(void 0===i)return;let d,x=(t.x-i.grx1)**2;if(1===t.nproc&&(x+=(t.y-i.gry1)**2),x>=l)return;if(i.error||i.rect||i.marker)d={x1:Math.min(-s,i.grx0,-h),x2:Math.max(s,i.grx2,h),y1:Math.min(-s,i.gry2,-h),y2:Math.max(s,i.gry0,h)};else if(i.bar){if(d={x1:-i.width/2,x2:i.width/2,y1:0,y2:e-i.gry1},n){const t=a.gry(0);d.y1=i.gry1>t?t-i.gry1:0,d.y2=i.gry1>t?0:t-i.gry1}}else d={x1:-5,x2:5,y1:-5,y2:5};const g=t.x>=i.grx1+d.x1&&t.x<=i.grx1+d.x2,f=t.y>=i.gry1+d.y1&&t.y<=i.gry1+d.y2;g&&(f||t.nproc>1)&&(l=x,o=this,c=d,c.exact=f)})),null===o)return null;const d=(0,r.Lt)(o).datum(),x=this.getGraph(),g={name:x.fName,title:x.fTitle,x:d.grx1,y:d.gry1,color1:this.lineatt.color,lines:this.getTooltips(d),rect:c,d3bin:o};return g.user_info={obj:x,name:x.fName,bin:d.indx,cont:d.y,grx:d.grx1,gry:d.gry1},this.fillatt?.used&&!this.fillatt?.empty()&&(g.color2=this.fillatt.getFillColor()),c.exact&&(g.exact=!0),g.menu=g.exact,g.menu_dist=3,g.bin=d,g.binindx=d.indx,g}showTooltip(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_g)return void i?.remove();if(t.usepath)return this.showTooltipForPath(t);const e=(0,r.Lt)(t.d3bin).datum();i.empty()&&(i=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(n.Ru)),t.changed=i.property("current_bin")!==t.d3bin,t.changed&&i.attr("x",e.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",e.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){const i=this.extractTooltip(t);return t&&t.disabled||this.showTooltip(i),i}findBestBin(t){if(!this.bins)return null;const i="lines"===this.draw_kind,e=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);let s,r,n,a,h,o=-1,l=null,c=1e10;for(a=0;a<this.bins.length;++a)h=this.bins[a],r=e.grx(h.x),n=e.gry(h.y),s=(t.x-r)**2+(t.y-n)**2,s<c&&(c=s,l=h,o=a);c>100&&i&&(l=null);let d=Math.max(this.lineatt.width+3,4);this.marker_size>0&&(d=Math.max(this.marker_size,d)),l&&(c=Math.sqrt((t.x-e.grx(l.x))**2+(t.y-e.gry(l.y))**2)),!i&&c>d&&(l=null),l||(o=-1);const x={bin:l,indx:o,dist:c,radius:Math.round(d)};if(!l&&i){c=1e10;const i=(t,i,e)=>i>=t&&t>=e||i<=t&&t<=e;let o,l=this.bins[0],g=e.grx(l.x),f=0;for(a=1;a<this.bins.length;++a)h=this.bins[a],r=e.grx(h.x),i(t.x,g,r)&&(o=e.gry(l.y),n=e.gry(h.y),Math.abs(r-g)<1?(f=t.y,s=i(t.y,o,n)?0:Math.min(Math.abs(t.y-o),Math.abs(t.y-n))):(f=o+(t.x-g)/(r-g)*(n-o),s=Math.abs(f-t.y)),s<c&&(c=s,x.linex=t.x,x.liney=f)),l=h,g=r;c<.5*d&&(x.linedist=c,x.closeline=!0)}return x}testEditable(t){const i=this.getGraph();return!!i&&(("toggle"===t||void 0!==t&&!t!==i.TestBit(x))&&i.InvertBit(x),!i.TestBit(x))}extractTooltipForPath(t){if(null===this.bins)return null;const i=this.findBestBin(t);if(!i||!i.bin&&!i.closeline)return null;const e="lines"===this.draw_kind,s="mark"===this.draw_kind,r=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),n=this.getGraph(),a={name:n.fName,title:n.fTitle,x:i.bin?r.grx(i.bin.x):i.linex,y:i.bin?r.gry(i.bin.y):i.liney,color1:this.lineatt.color,lines:this.getTooltips(i.bin),usepath:!0};return a.user_info={obj:n,name:n.fName,bin:0,cont:0,grx:a.x,gry:a.y},a.ismark=s,a.islines=e,i.closeline?(a.menu=a.exact=!0,a.menu_dist=i.linedist):i.bin&&(this.options.EF&&e?(a.gry1=r.gry(i.bin.y-i.bin.eylow),a.gry2=r.gry(i.bin.y+i.bin.eyhigh)):a.gry1=a.gry2=r.gry(i.bin.y),a.binindx=i.indx,a.bin=i.bin,a.radius=i.radius,a.user_info.bin=i.indx,a.user_info.cont=i.bin.y,a.exact=Math.abs(t.x-a.x)<=i.radius&&(Math.abs(t.y-a.gry1)<=i.radius||Math.abs(t.y-a.gry2)<=i.radius),a.menu=a.exact,a.menu_dist=Math.sqrt((t.x-a.x)**2+Math.min(Math.abs(t.y-a.gry1),Math.abs(t.y-a.gry2))**2)),this.fillatt?.used&&!this.fillatt?.empty()&&(a.color2=this.fillatt.getFillColor()),e||(a.color1=this.getColor(n.fMarkerColor),a.color2||(a.color2=a.color1)),a}showTooltipForPath(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(t?.bin&&this.draw_g){if(i.empty()&&(i=this.draw_g.append("svg:g").attr("class","tooltip_bin")),t.changed=i.property("current_bin")!==t.bin,t.changed)if(i.selectAll("*").remove(),i.property("current_bin",t.bin),t.ismark)i.append("svg:rect").style("pointer-events","none").call(n.Ru).style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{i.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&i.append("svg:circle").attr("cy",Math.round(t.gry2));const e=i.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(this.options.Line||this.options.Curve?e.call(this.lineatt.func):e.style("stroke","black"),this.options.Fill?e.call(this.fillatt.func):e.style("fill","none")):e.style("stroke","black"===t.color1?"green":"black").style("fill","none")}}else i?.remove()}moveEnabled(){return this.testEditable()}moveStart(t,i){this.pos_dx=this.pos_dy=0,this.move_funcs=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);const e=this.extractTooltip({x:t,y:i});e&&e.exact&&void 0!==e.binindx?(this.move_binindx=e.binindx,this.move_bin=e.bin,this.move_x0=this.move_funcs.grx(this.move_bin.x),this.move_y0=this.move_funcs.gry(this.move_bin.y)):delete this.move_binindx}moveDrag(t,i){this.pos_dx+=t,this.pos_dy+=i,void 0===this.move_binindx?(0,n.bk)(this.draw_g,this.pos_dx,this.pos_dy):this.move_funcs&&this.move_bin&&(this.move_bin.x=this.move_funcs.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=this.move_funcs.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())}moveEnd(t){const i=this.getGraph(),e=i?.fNpoints-1;let s="";const r=t=>{s+=`SetPoint(${t.indx},${t.x},${t.y});;`,i.fX[t.indx]=t.x,i.fY[t.indx]=t.y,0===t.indx&&this._cutg_lastsame&&(s+=`SetPoint(${e},${t.x},${t.y});;`,i.fX[e]=t.x,i.fY[e]=t.y)};if(void 0===this.move_binindx){if(this.draw_g.attr("transform",null),this.move_funcs&&this.bins&&!t){for(let t=0;t<this.bins.length;++t){const i=this.bins[t];i.x=this.move_funcs.revertAxis("x",this.move_funcs.grx(i.x)+this.pos_dx),i.y=this.move_funcs.revertAxis("y",this.move_funcs.gry(i.y)+this.pos_dy),r(i)}i.$redraw_pad?this.redrawPad():this.drawGraph()}}else r(this.move_bin),delete this.move_binindx,i.$redraw_pad&&this.redrawPad();delete this.move_funcs,s&&!t&&this.submitCanvExec(s)}fillWebObjectOptions(t){this._auto_exec&&t&&(t.fcust="auto_exec:"+this._auto_exec,delete this._auto_exec)}fillContextMenuItems(t){this.snapid||t.addchk(this.testEditable(),"Editable",(()=>{this.testEditable("toggle"),this.drawGraph()}))}executeMenuCommand(t,i){if(super.executeMenuCommand(t,i))return!0;const e=this.getCanvPainter(),r=this.get_main();if("RemovePoint"===t.fName||"InsertPoint"===t.fName){if(!e||e._readonly)return!0;const i=(0,s.isFunc)(r?.getLastEventPos)?r.getLastEventPos():null,n=this.extractTooltip(i);if("InsertPoint"===t.fName){if(i){const e=r.getGrFuncs(this.options.second_x,this.options.second_y),s=e.revertAxis("x",i.x)??0,n=e.revertAxis("y",i.y)??0;this.submitCanvExec(`AddPoint(${s.toFixed(3)}, ${n.toFixed(3)})`,t.$execid)}}else t.$execid&&void 0!==n?.binindx&&this.submitCanvExec(`RemovePoint(${n.binindx})`,t.$execid);return!0}return!1}_updateMembers(t,i){t.fBits=i.fBits,t.fTitle=i.fTitle,t.fX=i.fX,t.fY=i.fY,t.fNpoints=i.fNpoints,t.fMinimum=i.fMinimum,t.fMaximum=i.fMaximum;const e=this.options;return void 0!==this.snapid&&(e._pfc=e._plc=e._pmc=0),e._pfc||(t.fFillColor=i.fFillColor),t.fFillStyle=i.fFillStyle,e._plc||(t.fLineColor=i.fLineColor),t.fLineStyle=i.fLineStyle,t.fLineWidth=i.fLineWidth,e._pmc||(t.fMarkerColor=i.fMarkerColor),t.fMarkerSize=i.fMarkerSize,t.fMarkerStyle=i.fMarkerStyle,i.fFunctions}updateObject(t,i){if(!this.matchObjectType(t))return!1;i&&i!==this.options.original&&this.decodeOptions(i);const e=this._updateMembers(this.getObject(),t);if(this.createBins(),delete this.$redraw_hist,this.axes_draw){const t=this.createHistogram(),i=this.getMainPainter();i?.isSecondary(this)&&(i.updateObject(t,this.options.Axis),this.$redraw_hist=!0)}return this._funcHandler=new h.eP(this,this.getPadPainter(),e),!0}canZoomInside(t,i,e){const s=this.getGraph();if(!s||t!==(this.options.pos3d?"y":"x"))return!1;for(let r=0;r<s.fNpoints;++r)if(i<s.fX[r]&&s.fX[r]<e)return!0;return!1}clickButton(t){return"ToggleZoom"===t&&((this.xmin!==this.xmax||this.ymin!==this.ymax)&&this.getFramePainter()?.zoom(this.xmin,this.xmax,this.ymin,this.ymax))}findFunc(){return this.getGraph()?.fFunctions?.arr?.find((t=>t._typename===s.clTF1||t._typename===s.clTF2))}findStat(){return this.getGraph()?.fFunctions?.arr?.find((t=>t._typename===s.clTPaveStats&&"stats"===t.fName))}createStat(){const t=this.findFunc();if(!t)return null;let i=this.findStat();if(i)return i;if(this.getCanvPainter()?.normal_canvas)return null;this.create_stats=!0;const e=s.gStyle;return i=(0,s.create)(s.clTPaveStats),Object.assign(i,{fName:"stats",fOptStat:0,fOptFit:e.fOptFit||111,fBorderSize:1,fX1NDC:e.fStatX-e.fStatW,fY1NDC:e.fStatY-e.fStatH,fX2NDC:e.fStatX,fY2NDC:e.fStatY,fFillColor:e.fStatColor,fFillStyle:e.fStatStyle}),i.fTextAngle=0,i.fTextSize=e.fStatFontSize,i.fTextAlign=12,i.fTextColor=e.fStatTextColor,i.fTextFont=e.fStatFont,i.AddText(t.fName),this.getGraph().fFunctions.Add(i),i}fillStatistic(t,i,e){const s=this.findFunc();return!(!s||!e)&&(t.clearPave(),t.fillFunctionStat(s,1===e?111:e,1),!0)}async drawAxisHisto(){const t=this.createHistogram();return o.N.draw(this.getDom(),t,this.options.Axis)}static async _drawGraph(t,i){t.decodeOptions(i,!0),t.createBins(),t.createStat();const e=t.getGraph();s.settings.DragGraphs||!e||e.TestBit(x)||e.InvertBit(x);let r=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(r=t.drawAxisHisto().then((i=>{i?.setSecondaryId(t,"hist"),t.axes_draw=!!i}))),r.then((()=>(t.addToPadPrimitives(),t.drawGraph()))).then((()=>new h.eP(t,t.getPadPainter(),e.fFunctions,!0).drawNext(0)))}static async draw(t,i,e){return y._drawGraph(new y(t,i),e)}}}}]);
//# sourceMappingURL=3921.d940e4cc.chunk.js.map