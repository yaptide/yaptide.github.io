"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[2454],{2454:(t,e,a)=>{a.r(e),a.d(e,{RPalettePainter:()=>v,drawBox:()=>g,drawLine:()=>c,drawMarker:()=>u,drawText:()=>d});var i=a(9490),n=a(8260),r=a(1597),s=a(7243),o=a(7124),l=a(4709),h=a(3558);function d(){const t=this.getObject(),e=this.getPadPainter(),a=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,i=!!a&&this.v7EvalAttr("clipping",!1),n=e.getCoordinate(t.fPos,a),r=this.v7EvalFont("text",{size:12,color:"black",align:22});return this.createG(i?"main_layer":!!a&&"upper_layer"),this.startTextDrawing(r,"font"),this.drawText({x:n.x,y:n.y,text:t.fText,latex:1}),this.finishTextDrawing()}function c(){const t=this.getObject(),e=this.getPadPainter(),a=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,i=!!a&&this.v7EvalAttr("clipping",!1),n=e.getCoordinate(t.fP1,a),r=e.getCoordinate(t.fP2,a);this.createG(i?"main_layer":!!a&&"upper_layer"),this.createv7AttLine(),this.draw_g.append("svg:path").attr("d",`M${n.x},${n.y}L${r.x},${r.y}`).call(this.lineatt.func)}function g(){const t=this.getObject(),e=this.getPadPainter(),a=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,i=!!a&&this.v7EvalAttr("clipping",!1),n=e.getCoordinate(t.fP1,a),r=e.getCoordinate(t.fP2,a);this.createG(i?"main_layer":!!a&&"upper_layer"),this.createv7AttLine("border_"),this.createv7AttFill(),this.draw_g.append("svg:path").attr("d",`M${n.x},${n.y}H${r.x}V${r.y}H${n.x}Z`).call(this.lineatt.func).call(this.fillatt.func)}function u(){const t=this.getObject(),e=this.getPadPainter(),a=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,i=!!a&&this.v7EvalAttr("clipping",!1),n=e.getCoordinate(t.fP,a);this.createG(i?"main_layer":!!a&&"upper_layer"),this.createv7AttMarker();const r=this.markeratt.create(n.x,n.y);r&&this.draw_g.append("svg:path").attr("d",r).call(this.markeratt.func)}class v extends s.D{getHistPalette(){const t=this.getObject()?.fPalette;return t&&!(0,i.isFunc)(t.getColor)&&(0,i.addMethods)(t,`${i.nsREX}RPalette`),t}drawPalette(t){const e=this.getHistPalette(),a=e.getContour(),s=this.getFramePainter();if(!a)return console.log("no contour - no palette");if(!s)return console.log("no frame painter - no palette");const l=a[0],d=a[a.length-1],c=s.getFrameRect(),g=this.getPadPainter().getPadWidth(),u=this.getPadPainter().getPadHeight(),v=this.v7EvalAttr("visible",!0),p=this.v7EvalAttr("vertical",!0);let m,f,w,x,_=e.full_min,y=e.full_max;if(t){w=t.width,x=t.height;const e={};p?(this.v7AttrChange(e,"margin",(t.x-c.x-c.width)/g),this.v7AttrChange(e,"width",w/g)):(this.v7AttrChange(e,"margin",(t.y-c.y-c.height)/g),this.v7AttrChange(e,"width",x/u)),this.v7SendAttrChanges(e,!1)}else{if(p){const t=this.v7EvalLength("margin",g,.02);m=Math.round(c.x+c.width+t),w=this.v7EvalLength("width",g,.05),f=c.y,x=c.height}else{const t=this.v7EvalLength("margin",u,.02);m=c.x,w=c.width,f=Math.round(c.y+c.height+t),x=this.v7EvalLength("width",u,.05)}(0,r.bk)(this.draw_g,m,f)}let P=this.draw_g.selectChild(".colbtns");if(P.empty()?P=this.draw_g.append("svg:g").attr("class","colbtns"):P.selectAll("*").remove(),!v)return;P.append("svg:path").attr("d",`M0,0H${w}V${x}H0Z`).style("stroke","black").style("fill","none"),void 0!==_&&void 0!==y||(_=l,y=d),p?s.z_handle.configureAxis("zaxis",_,y,l,d,!0,[x,0],-x,{reverse:!1}):s.z_handle.configureAxis("zaxis",_,y,l,d,!1,[0,w],w,{reverse:!1});for(let r=0;r<a.length-1;++r){const t=Math.round(s.z_handle.gr(a[r])),o=Math.round(s.z_handle.gr(a[r+1])),l=e.getContourColor((a[r]+a[r+1])/2),h=P.append("svg:path").attr("d",p?`M0,${o}H${w}V${t}H0Z`:`M${t},0V${x}H${o}V0Z`).style("fill",l).style("stroke",l).property("fill0",l).property("fill1",(0,n.Qh)(l).darker(.5).toString());this.isTooltipAllowed()&&h.on("mouseover",(function(){(0,n.Lt)(this).transition().duration(100).style("fill",(0,n.Lt)(this).property("fill1"))})).on("mouseout",(function(){(0,n.Lt)(this).transition().duration(100).style("fill",(0,n.Lt)(this).property("fill0"))})).append("svg:title").text(a[r].toFixed(2)+" - "+a[r+1].toFixed(2)),i.settings.Zooming&&h.on("dblclick",(()=>s.unzoom("z")))}s.z_handle.maxTickSize=Math.round(.3*w);const z=s.z_handle.drawAxis(this.draw_g,(0,r.bk)(p?w:0,x),p?-1:1);return this.isBatchMode()||t?z:z.then((()=>{if(i.settings.ContextMenu&&this.draw_g.on("contextmenu",(t=>{t.stopPropagation(),t.preventDefault(),(0,h.ES)(t,this).then((t=>{t.add("header:Palette"),t.addchk(p,"Vertical",(t=>{this.v7SetAttr("vertical",t),this.redrawPad()})),s.z_handle.fillAxisContextMenu(t,"z"),t.show()}))})),(0,o.WJ)(this,{x:m,y:f,width:w,height:x,minwidth:20,minheight:20,no_change_x:!p,no_change_y:p,redraw:t=>this.drawPalette(t)}),!i.settings.Zooming)return;let t,e,a,r,l=!1,d=0,c=0;const g=i=>{if(!l)return;if(i.preventDefault(),r=(0,n.Wn)(i,this.draw_g.node()),a)return s.z_handle.processLabelsMove("move",r);c=p?Math.min(Math.max(r[1],0),x):Math.min(Math.max(r[0],0),w);const o=Math.abs(c-d);!e&&o>1&&(t.style("display",null),e=!0),p?t.attr("y",Math.min(d,c)).attr("height",o):t.attr("x",Math.min(d,c)).attr("width",o)},u=e=>{if(l)if(e.preventDefault(),(0,n.Lt)(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),t.remove(),t=null,l=!1,a)s.z_handle.processLabelsMove("stop",r);else{const t=s.z_handle.func,e=t.invert(d),a=t.invert(c);this.getFramePainter().zoom("z",Math.min(e,a),Math.max(e,a))}},v=i=>{l||(l=!0,i.preventDefault(),i.stopPropagation(),r=(0,n.Wn)(i,this.draw_g.node()),d=c=r[p?1:0],e=!1,a=!1,t=P.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").style("display","none"),p?t.attr("x",0).attr("width",w).attr("y",d).attr("height",1):t.attr("x",d).attr("width",1).attr("y",0).attr("height",x),(0,n.Lt)(window).on("mousemove.colzoomRect",g).on("mouseup.colzoomRect",u,!0),setTimeout((()=>{!e&&l&&(a=s.z_handle.processLabelsMove("start",r))}),500))},_=()=>{this.draw_g.selectAll(".axis_zoom, .axis_labels").on("mousedown",v).on("dblclick",(()=>s.unzoom("z"))),i.settings.ZoomWheel&&this.draw_g.on("wheel",(t=>{t.stopPropagation(),t.preventDefault();const e=(0,n.Wn)(t,this.draw_g.node()),a=p?1-e[1]/x:e[0]/w,i=s.z_handle.analyzeWheelEvent(t,a);i.changed&&s.zoom("z",i.min,i.max)}))};s.z_handle.setAfterDrawHandler(_),_()}))}static async draw(t,e,a){const i=new v(t,e,a,"palette");return(0,l.ensureRCanvas)(i,!1).then((()=>(i.createG(),i)))}}}}]);
//# sourceMappingURL=2454.5ea5748f.chunk.js.map