"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[3927,6914],{6914:(t,e,i)=>{i.r(e),i.d(e,{TF1Painter:()=>c,produceTAxisLogScale:()=>l,scanTF1Options:()=>m});var s=i(9490),a=i(1597),n=i(6950),r=i(4913),o=i(4978),f=i(4041);function l(t,e,i,s){let a,n;s>0?(n=Math.log(s),a=i>0?Math.log(i):n-5):(n=-10,a=-15),t.fNbins=e,t.fXbins=new Array(e+1);for(let r=0;r<=e;++r)t.fXbins[r]=Math.exp(a+r/e*(n-a));t.fXmin=Math.exp(a),t.fXmax=Math.exp(n)}function m(t){(0,s.isStr)(t)||(t="");let e=t.indexOf(";webcanv_hist"),i=!1,a=0;return e>=0&&(i=!0,t=t.slice(0,e)),e=t.indexOf(";force_saved"),e>=0&&(a=2,t=t.slice(0,e)),e=t.indexOf(";prefer_saved"),e>=0&&(a=1,t=t.slice(0,e)),{opt:t,webcanv_hist:i,use_saved:a}}class c extends o.N{getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??s.clTF1}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(t){if(!t||this.getClassName()!==t._typename)return!1;delete t.evalPar;const e=this.getHisto();if(this.webcanv_hist){const t=this.getPadPainter()?.findInPrimitives("Func",s.clTH1D);t&&this.updateAxes(e,t,this.getFramePainter())}return this.$func=t,this.createTF1Histogram(t,e),this.scanContent(),!0}redraw(t){return this._use_saved_points||"logx"!==t&&"zoom"!==t||(this.createTF1Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(t)}createTF1Histogram(t,e){const i=this.getFramePainter(),a=this.getPadPainter()?.getRootPad(!0),n=a?.fLogx,r=i?.getGrFuncs(this.second_x,this.second_y);let o=t.fXmin,m=t.fXmax,c=Math.max(t.fNpx,100);if(r?.zoom_xmin!==r?.zoom_xmax){const t=(m-o)/c;o<r.zoom_xmin&&r.zoom_xmin<m&&(o=Math.max(o,r.zoom_xmin-t)),o<r.zoom_xmax&&r.zoom_xmax<m&&(m=Math.min(m,r.zoom_xmax+t))}this._use_saved_points=t.fSave.length>3&&(s.settings.PreferSavedPoints||this.use_saved>1);const h=t=>{e.fNcells!==t+2&&(e.fNcells=t+2,e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=t,e.fXaxis.fXbins=[]};if(delete this._fail_eval,!this._use_saved_points){let i=!1;if(!t.evalPar)try{(0,f.Dx)(t)||(i=!0)}catch{i=!0}h(c),n?l(e.fXaxis,c,o,m):(e.fXaxis.fXmin=o,e.fXaxis.fXmax=m);for(let s=0;s<c&&!i;s++){const a=e.fXaxis.GetBinCenter(s+1);let n=0;try{n=t.evalPar(a)}catch(x){i=!0}i||e.setBinContent(s+1,Number.isFinite(n)?n:0)}i&&(this._fail_eval=!0),i&&t.fSave.length>3&&(this._use_saved_points=!0)}if(this._use_saved_points){c=t.fSave.length-3;let i=null;if(o=t.fSave[c+1],m=t.fSave[c+2],o===m){const t=this.getMainPainter();(0,s.isFunc)(t?.getHisto)&&(i=t?.getHisto()?.fXaxis)}if(i){h(e.fXaxis.fNbins),Object.assign(e.fXaxis,i);for(let i=0;i<c;++i){const s=t.fSave[i];e.setBinContent(i+1,Number.isFinite(s)?s:0)}}else{h(t.fNpx),e.fXaxis.fXmin=t.fXmin,e.fXaxis.fXmax=t.fXmax;for(let i=0;i<t.fNpx;++i){const s=(0,f.YI)(t,e.fXaxis.GetBinCenter(i+1));e.setBinContent(i+1,Number.isFinite(s)?s:0)}}}e.fName="Func",(0,s.setHistogramTitle)(e,t.fTitle),e.fMinimum=t.fMinimum,e.fMaximum=t.fMaximum,e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize,e.fBits|=s.kNoStats}extractAxesProperties(t){super.extractAxesProperties(t);const e=this.$func,i=e?.fSave.length??0;i>3&&this._use_saved_points&&(this.xmin=Math.min(this.xmin,e.fSave[i-2]),this.xmax=Math.max(this.xmax,e.fSave[i-1])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax))}canZoomInside(t,e,i){const s=this.$func?.fSave.length??0;if(s>3&&this._use_saved_points&&"x"===t){const t=s-2,a=this.$func.fSave[s-2],n=this.$func.fSave[s-1];return Math.abs(n-a)/t<Math.abs(i-e)}return"x"===t||"y"===t}getTF1Tooltips(t){delete this.$tmp_tooltip;const e=[this.getObjectHint()],i=this.getFramePainter()?.getGrFuncs(this.options.second_x,this.options.second_y);if(!i||!(0,s.isFunc)(this.$func?.evalPar))return e.push("grx = "+t.x,"gry = "+t.y),e;const n=i.revertAxis("x",t.x);let r=0,o=0,f=!1;try{r=this.$func.evalPar(n),o=Math.round(i.gry(r))}catch{f=!0}return e.push("x = "+i.axisAsText("x",n),"value = "+(f?"<fail>":(0,a.lg)(r,s.gStyle.fStatFormat))),f||(this.$tmp_tooltip={y:r,gry:o}),e}processTooltipEvent(t){if(this._use_saved_points)return super.processTooltipEvent(t);let e=this.draw_g?.selectChild(".tooltip_bin");if(!this.draw_g||!t)return e?.remove(),null;const i={name:this.$func?.fName,title:this.$func?.fTitle,x:t.x,y:t.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF1Tooltips(t),exact:!0,menu:!0};return t.disabled?e.remove():(e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),e.attr("cx",t.x).attr("cy",this.$tmp_tooltip.gry??t.y).call(this.lineatt?.func)),i}fillWebObjectOptions(t){t.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static async draw(t,e,i){const a=m(i);let o;if(i=a.opt,delete a.opt,a.webcanv_hist){const e=new n.JW(t);o=e.getPadPainter()?.findInPrimitives("Func",s.clTH1D)}o||(o=(0,s.createHistogram)(s.clTH1D,100),o.fBits|=s.kNoStats),!i&&(0,n.Nn)(t)&&(i="same");const f=new c(t,o);return f.$func=e,Object.assign(f,a),f.createTF1Histogram(e,o),r.mf._drawHist(f,i)}}},3927:(t,e,i)=>{i.r(e),i.d(e,{TF2Painter:()=>m});var s=i(9490),a=i(1225),n=i(4041),r=i(6914),o=i(6950),f=i(1597),l=i(4913);class m extends a.TH2Painter{getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??s.clTF2}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(t){if(!t||this.getClassName()!==t._typename)return!1;delete t.evalPar;const e=this.getHisto();if(this.webcanv_hist){const t=this.getPadPainter()?.findInPrimitives("Func",s.clTH2F);t&&this.updateAxes(e,t,this.getFramePainter())}return this.$func=t,this.createTF2Histogram(t,e),this.scanContent(),!0}redraw(t){return this._use_saved_points||"logx"!==t&&"logy"!==t&&"zoom"!==t||(this.createTF2Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(t)}createTF2Histogram(t,e){let i=t.fSave.length-6;i>0&&i!==(t.fSave[i+4]+1)*(t.fSave[i+5]+1)&&(i=0),this._use_saved_points=i>0&&(s.settings.PreferSavedPoints||this.use_saved>1);const a=this.getFramePainter(),o=this.getPadPainter()?.getRootPad(!0),f=o?.fLogx,l=o?.fLogy,m=a?.getGrFuncs(this.second_x,this.second_y);let c=t.fXmin,h=t.fXmax,x=t.fYmin,u=t.fYmax,_=Math.max(t.fNpx,20),p=Math.max(t.fNpy,20);if(m?.zoom_xmin!==m?.zoom_xmax){const g=(h-c)/_;c<m.zoom_xmin&&m.zoom_xmin<h&&(c=Math.max(c,m.zoom_xmin-g)),c<m.zoom_xmax&&m.zoom_xmax<h&&(h=Math.min(h,m.zoom_xmax+g))}if(m?.zoom_ymin!==m?.zoom_ymax){const v=(u-x)/p;x<m.zoom_ymin&&m.zoom_ymin<u&&(x=Math.max(x,m.zoom_ymin-v)),x<m.zoom_ymax&&m.zoom_ymax<u&&(u=Math.min(u,m.zoom_ymax+v))}const d=(t,i)=>{e.fNcells!==(t+2)*(i+2)&&(e.fNcells=(t+2)*(i+2),e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=t,e.fXaxis.fXbins=[],e.fYaxis.fNbins=i,e.fYaxis.fXbins=[]};if(delete this._fail_eval,!this._use_saved_points){let y=!1;t.evalPar||(0,n.Dx)(t)||(y=!0),d(_,p),e.fXaxis.fXmin=c,e.fXaxis.fXmax=h,e.fYaxis.fXmin=x,e.fYaxis.fXmax=u,f&&(0,r.produceTAxisLogScale)(e.fXaxis,_,c,h),l&&(0,r.produceTAxisLogScale)(e.fYaxis,p,x,u);for(let S=0;S<p&&!y;++S)for(let F=0;F<_&&!y;++F){const M=e.fXaxis.GetBinCenter(F+1),X=e.fYaxis.GetBinCenter(S+1);let b=0;try{b=t.evalPar(M,X)}catch{y=!0}y||e.setBinContent(e.getBin(F+1,S+1),Number.isFinite(b)?b:0)}y&&(this._fail_eval=!0),y&&i>6&&(this._use_saved_points=!0)}if(this._use_saved_points){_=Math.round(t.fSave[i+4]),p=Math.round(t.fSave[i+5]);const P=t.fSave[i],T=t.fSave[i+1],N=t.fSave[i+2],C=t.fSave[i+3],w=(T-P)/_,A=(C-N)/p;function z(e,i){if(e<P||e>T)return 0;if(w<=0)return 0;if(i<N||i>C)return 0;if(A<=0)return 0;const s=Math.min(_-1,Math.floor((e-P)/w)),a=Math.min(p-1,Math.floor((i-N)/A)),n=(e-(P+s*w))/w,r=(i-(N+a*A))/A,o=a*(_+1)+s,f=a*(_+1)+s+1,l=(a+1)*(_+1)+s+1,m=(a+1)*(_+1)+s;return(1-n)*(1-r)*t.fSave[o]+n*(1-r)*t.fSave[f]+n*r*t.fSave[l]+(1-n)*r*t.fSave[m]}d(t.fNpx,t.fNpy),e.fXaxis.fXmin=t.fXmin,e.fXaxis.fXmax=t.fXmax,e.fYaxis.fXmin=t.fYmin,e.fYaxis.fXmax=t.fYmax;for(let H=0;H<t.fNpy;++H){const $=e.fYaxis.GetBinCenter(H+1);for(let O=0;O<t.fNpx;++O){const L=z(e.fXaxis.GetBinCenter(O+1),$);e.setBinContent(e.getBin(O+1,H+1),Number.isFinite(L)?L:0)}}}return e.fName="Func",(0,s.setHistogramTitle)(e,t.fTitle),e.fMinimum=t.fMinimum,e.fMaximum=t.fMaximum,e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize,e.fBits|=s.kNoStats,e}extractAxesProperties(t){super.extractAxesProperties(t);const e=this.$func,i=e?.fSave.length??0;i>6&&this._use_saved_points&&(this.xmin=Math.min(this.xmin,e.fSave[i-6]),this.xmax=Math.max(this.xmax,e.fSave[i-5]),this.ymin=Math.min(this.ymin,e.fSave[i-4]),this.ymax=Math.max(this.ymax,e.fSave[i-3])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax),this.ymin=Math.min(this.ymin,e.fYmin),this.ymax=Math.max(this.ymax,e.fYmax))}getTF2Tooltips(t){const e=[this.getObjectHint()],i=this.getFramePainter()?.getGrFuncs(this.options.second_x,this.options.second_y);if(!i||!(0,s.isFunc)(this.$func?.evalPar))return e.push("grx = "+t.x,"gry = "+t.y),e;const a=i.revertAxis("x",t.x),n=i.revertAxis("y",t.y);let r=0,o=!1;try{r=this.$func.evalPar(a,n)}catch{o=!0}return e.push("x = "+i.axisAsText("x",a),"y = "+i.axisAsText("y",n),"value = "+(o?"<fail>":(0,f.lg)(r,s.gStyle.fStatFormat))),e}processTooltipEvent(t){if(this._use_saved_points)return super.processTooltipEvent(t);let e=this.draw_g?.selectChild(".tooltip_bin");if(!this.draw_g||!t)return e?.remove(),null;const i={name:this.$func?.fName,title:this.$func?.fTitle,x:t.x,y:t.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF2Tooltips(t),exact:!0,menu:!0};return t.disabled?e.remove():(e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),e.attr("cx",t.x).attr("cy",t.y).call(this.lineatt?.func)),i}fillWebObjectOptions(t){t.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static async draw(t,e,i){const a=(0,r.scanTF1Options)(i);i=a.opt,delete a.opt;const n=new f.nC(i);n.empty()?i="cont3":"SAME"===n.opt&&(i="cont2 same");const c=(0,s.isStr)(i)?i.toUpperCase():"";let h;if("SAMECOLORZ"!==c&&"SAMECOLOR"!==c&&"SAMECOLZ"!==c||(i="samecol"),0!==i.indexOf("same")&&0!==i.indexOf("SAME")||(0,o.Nn)(t)||(i="A_ADJUST_FRAME_"+i.slice(4)),a.webcanv_hist){const e=new o.JW(t);h=e.getPadPainter()?.findInPrimitives("Func",s.clTH2F)}h||(h=(0,s.createHistogram)(s.clTH2F,20,20),h.fBits|=s.kNoStats);const x=new m(t,h);return x.$func=e,Object.assign(x,a),x.createTF2Histogram(e,h),l.mf._drawHist(x,i)}}}}]);
//# sourceMappingURL=3927.73c4bb26.chunk.js.map