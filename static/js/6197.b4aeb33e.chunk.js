"use strict";(self.webpackChunkthreejs_editor_react=self.webpackChunkthreejs_editor_react||[]).push([[6197],{6197:(t,i,s)=>{s.r(i),s.d(i,{TGraph2DPainter:()=>d});var h=s(9490),f=s(881),e=s(1597),r=s(6950),n=s(1225),a=s(6183),o=s(273),l=s(227);function N(t){let i=t[0];for(let s=1;s<t.length;++s)i=Math.max(i,t[s]);return i}function c(t){let i=t[0];for(let s=1;s<t.length;++s)i=Math.min(i,t[s]);return i}class X{constructor(t){this.fGraph2D=t,this.fX=t.fX,this.fY=t.fY,this.fZ=t.fZ,this.fNpoints=t.fNpoints,this.fZout=0,this.fNdt=0,this.fNhull=0,this.fHullPoints=null,this.fXN=null,this.fYN=null,this.fOrder=null,this.fDist=null,this.fPTried=null,this.fNTried=null,this.fMTried=null,this.fInit=!1,this.fXNmin=0,this.fXNmax=0,this.fYNmin=0,this.fYNmax=0,this.fXoffset=0,this.fYoffset=0,this.fXScaleFactor=0,this.fYScaleFactor=0,this.SetMaxIter()}Initialize(){this.fInit||(this.CreateTrianglesDataStructure(),this.FindHull(),this.fInit=!0)}ComputeZ(t,i){this.Initialize();const s=(t+this.fXoffset)*this.fXScaleFactor,h=(i+this.fYoffset)*this.fYScaleFactor;let f=this.Interpolate(s,h);return 0===f&&(f=this.Interpolate(s+1e-4,h)),f}CreateTrianglesDataStructure(){const t=N(this.fGraph2D.fX),i=N(this.fGraph2D.fY),s=c(this.fGraph2D.fX),h=c(this.fGraph2D.fY);this.fXoffset=-(t+s)/2,this.fYoffset=-(i+h)/2,this.fXScaleFactor=1/(t-s),this.fYScaleFactor=1/(i-h),this.fXNmax=(t+this.fXoffset)*this.fXScaleFactor,this.fXNmin=(s+this.fXoffset)*this.fXScaleFactor,this.fYNmax=(i+this.fYoffset)*this.fYScaleFactor,this.fYNmin=(h+this.fYoffset)*this.fYScaleFactor,this.fXN=new Array(this.fNpoints+1),this.fYN=new Array(this.fNpoints+1);for(let f=0;f<this.fNpoints;f++)this.fXN[f+1]=(this.fX[f]+this.fXoffset)*this.fXScaleFactor,this.fYN[f+1]=(this.fY[f]+this.fYoffset)*this.fYScaleFactor;this.fPTried=[],this.fNTried=[],this.fMTried=[]}Enclose(t,i,s,h){const f=[this.fXN[t],this.fXN[i],this.fXN[s],this.fXN[t]],e=[this.fYN[t],this.fYN[i],this.fYN[s],this.fYN[t]],r=this.fXN[h],n=this.fYN[h];let a=0,o=f.length-1,l=!1;for(;a<f.length;++a)(e[a]<n&&e[o]>=n||e[o]<n&&e[a]>=n)&&f[a]+(n-e[a])/(e[o]-e[a])*(f[o]-f[a])<r&&(l=!l),o=a;return l}FileIt(t,i,s){let h,f,e=t,r=i,n=s;do{h=!1,r>e&&(f=e,e=r,r=f,h=!0),n>r&&(f=r,r=n,n=f,h=!0)}while(h);this.fNdt++,this.fPTried.push(e),this.fNTried.push(r),this.fMTried.push(n)}FindAllTriangles(){if(this.fAllTri)return;this.fAllTri=!0;let t,i,s,h,f,e,r,n,a,o,l,N,c,X,Y,d,p,u,m,g,M,x,T,w,y,_=0,P=0,I=0;const k=[!1,!1,!1],C=1e-4;for(this.Initialize(),t=0,i=0,y=1;y<=this.fNhull;y++)t+=this.fXN[this.fHullPoints[y-1]],i+=this.fYN[this.fHullPoints[y-1]];for(t=t/this.fNhull+C,i=i/this.fNhull+C,this.Interpolate(t,i),d=1;d<=this.fNdt;){for(u=this.fPTried[d-1],m=this.fNTried[d-1],g=this.fMTried[d-1],k[0]=!1,k[1]=!1,k[2]=!1,p=1;p<=this.fNdt;p++)p!==d&&(M=this.fPTried[p-1],x=this.fNTried[p-1],T=this.fMTried[p-1],u===M&&m===x||u===M&&m===T||u===x&&m===T?k[0]=!0:u===M&&g===x||u===M&&g===T||u===x&&g===T?k[1]=!0:(m===M&&g===x||m===M&&g===T||m===x&&g===T)&&(k[2]=!0)),k[0]&&k[1]&&k[2];for(w=1;w<=3;w++)k[w-1]||(1===w?(_=u,P=m,I=g):2===w?(_=u,P=g,I=m):3===w&&(_=m,P=g,I=u),s=(this.fXN[_]+this.fXN[P])/2,h=(this.fYN[_]+this.fYN[P])/2,r=this.fXN[_]-this.fXN[P],n=this.fYN[_]-this.fYN[P],a=n,o=-r,X=Math.sqrt(a*a+o*o),a/=X,o/=X,l=this.fXN[I]-s,N=this.fYN[I]-h,c=l*a+N*o,c>0&&(a=-a,o=-o),Y=Math.abs(Math.max(C*s,C*h)),f=s+a*Y,e=h+o*Y,this.Interpolate(f,e));d++}}FindHull(){this.fHullPoints||(this.fHullPoints=new Array(this.fNpoints));let t=0;for(let i=1;i<=this.fNpoints;i++){this.InHull(i,i)||(t++,this.fHullPoints[t-1]=i)}this.fNhull=t}InHull(t,i){let s,h,f,e,r,n,a,o,l,N,c,X,Y,d,p,u,m,g,M,x,T,w=!1;const y=this.fXN[t],_=this.fYN[t];for(r=this.fNhull>0?this.fNhull:this.fNpoints,s=1,h=2,s===i?(s=h,h++):h===i&&h++,l=y-this.fXN[s],X=_-this.fYN[s],N=y-this.fXN[h],Y=_-this.fYN[h],M=Math.atan2(X,l),x=Math.atan2(Y,N),T=M-x-Math.floor((M-x)/(2*Math.PI))*Math.PI*2,T<0&&(T+=2*Math.PI),n=T,f=1;f<=r;f++)if(e=this.fNhull>0?this.fHullPoints[f-1]:f,e!==s&&e!==h&&e!==i&&(l=y-this.fXN[s],X=_-this.fYN[s],N=y-this.fXN[h],Y=_-this.fYN[h],c=y-this.fXN[e],d=_-this.fYN[e],a=N*X-l*Y,o=l*Y-N*X,a*o!==0&&(p=(N*d-c*Y)/a,u=(l*d-c*X)/o,p<0||u<0))){if(m=(l*c+X*d)/Math.sqrt(l*l+X*X),g=(N*c+Y*d)/Math.sqrt(N*N+Y*Y),m>g?(s=e,M=Math.atan2(d,c),x=Math.atan2(Y,N)):(h=e,M=Math.atan2(X,l),x=Math.atan2(d,c)),T=M-x-Math.floor((M-x)/(2*Math.PI))*Math.PI*2,T<0&&(T+=2*Math.PI),(T-Math.PI)*(n-Math.PI)<0)return w=!0,w;n=T}return w}InterpolateOnPlane(t,i,s,h){let f,e,r=t,n=i,a=s;do{e=!1,n>r&&(f=r,r=n,n=f,e=!0),a>n&&(f=n,n=a,a=f,e=!0)}while(e);const o=this.fXN[r],l=this.fXN[n],N=this.fXN[a],c=this.fYN[r],X=this.fYN[n],Y=this.fYN[a],d=this.fZ[r-1],p=this.fZ[n-1],u=this.fZ[a-1],m=(d*(X-Y)+p*(Y-c)+u*(c-X))/(o*(X-Y)+l*(Y-c)+N*(c-X)),g=(d*(l-N)+p*(N-o)+u*(o-l))/(c*(l-N)+X*(N-o)+Y*(o-l)),M=d-m*o-g*c;return m*this.fXN[h]+g*this.fYN[h]+M}Interpolate(t,i){let s,h,f,e,r,n,a,o,l,N,c,X,Y,d,p,u,m,g,M,x,T,w,y,_,P,I,k,C,Z,E,F,b,z,O,A,D,S,H,L,j,v,q,$,G=0,B=0,R=0,W=0,Q=0;const J=[0,0,0],K=[0,0,0];if(this.Initialize(),this.fOrder||(this.fOrder=new Array(this.fNpoints),this.fDist=new Array(this.fNpoints)),this.fXN[0]=t,this.fYN[0]=i,s=this.fZout,f=0,t>this.fXNmax||t<this.fXNmin||i>this.fYNmax||i<this.fYNmin)return s;for(h=1;h<=this.fNdt;h++)if(e=this.fPTried[h-1],r=this.fNTried[h-1],n=this.fMTried[h-1],this.Enclose(e,r,n,0))return s=this.InterpolateOnPlane(e,r,n,0),s;const V=this.InHull(0,-1);if(!V)return s;for(h=1;h<=this.fNpoints;h++)T=this.fXN[h],w=this.fYN[h],this.fDist[h-1]=Math.sqrt((t-T)*(t-T)+(i-w)*(i-w));for(function(t,i,s){const h=new Array(t);for(let f=0;f<t;++f)h[f]={v:i[f],i:f};h.sort(((t,i)=>t.v<i.v?-1:t.v>i.v?1:0));for(let f=0;f<t;++f)s[f]=h[f].i}(this.fNpoints,this.fDist,this.fOrder),h=0;h<this.fNpoints;h++)this.fOrder[h]++;for(l=3;l<=this.fNpoints;l++)for(n=this.fOrder[l-1],o=2;o<=l-1;o++)for(r=this.fOrder[o-1],a=1;a<=o-1;a++){let t=!1;if(e=this.fOrder[a-1],f>this.fMaxIter)return s;if(f++,y=Math.sqrt((this.fXN[e]-this.fXN[r])**2+(this.fYN[e]-this.fYN[r])**2),_=Math.sqrt((this.fXN[e]-this.fXN[n])**2+(this.fYN[e]-this.fYN[n])**2),P=Math.sqrt((this.fXN[r]-this.fXN[n])**2+(this.fYN[r]-this.fYN[n])**2),!(y+_<=P||y+P<=_||_+P<=y)&&this.Enclose(e,r,n,0)){for(G=0,c=1;c<=this.fNpoints;c++)if(c!==e&&c!==r&&c!==n){for(N=1;N<=this.fNpoints;N++)if(this.fOrder[N-1]===c){if(!(N<a||N<o||N<l))break;if(this.Enclose(e,r,n,c)){t=!0;break}}if(t)break;if((this.fXN[e]-this.fXN[c])*(this.fYN[e]-this.fYN[r])===(this.fYN[e]-this.fYN[c])*(this.fXN[e]-this.fXN[r])?(u=e,m=r):(this.fXN[e]-this.fXN[c])*(this.fYN[e]-this.fYN[n])===(this.fYN[e]-this.fYN[c])*(this.fXN[e]-this.fXN[n])?(u=e,m=n):(this.fXN[r]-this.fXN[c])*(this.fYN[r]-this.fYN[n])===(this.fYN[r]-this.fYN[c])*(this.fXN[r]-this.fXN[n])?(u=r,m=n):(u=0,m=0),0===u){if(t)break;for(X=n,d=e,p=r,J[0]=this.fXN[e]-this.fXN[c],K[0]=this.fYN[e]-this.fYN[c],J[1]=this.fXN[r]-this.fXN[c],K[1]=this.fYN[r]-this.fYN[c],J[2]=this.fXN[n]-this.fXN[c],K[2]=this.fYN[n]-this.fYN[c],N=1;N<=3;N++)if(D=J[N-1],S=J[N%3],H=J[(N+1)%3],L=K[N-1],j=K[N%3],v=K[(N+1)%3],q=(v*S-H*j)*(L*S-D*j),$=(v*D-H*L)*(j*D-S*L),q>=0&&$>=0){1===N?(X=n,d=e,p=r):2===N?(X=e,d=r,p=n):(X=r,d=n,p=e);break}if(z=((this.fXN[X]-this.fXN[d])*(this.fXN[c]-this.fXN[d])+(this.fYN[X]-this.fYN[d])*(this.fYN[c]-this.fYN[d]))/Math.sqrt(((this.fXN[X]-this.fXN[d])*(this.fXN[X]-this.fXN[d])+(this.fYN[X]-this.fYN[d])*(this.fYN[X]-this.fYN[d]))*((this.fXN[c]-this.fXN[d])*(this.fXN[c]-this.fXN[d])+(this.fYN[c]-this.fYN[d])*(this.fYN[c]-this.fYN[d]))),O=((this.fXN[p]-this.fXN[d])*(this.fXN[c]-this.fXN[d])+(this.fYN[p]-this.fYN[d])*(this.fYN[c]-this.fYN[d]))/Math.sqrt(((this.fXN[p]-this.fXN[d])*(this.fXN[p]-this.fXN[d])+(this.fYN[p]-this.fYN[d])*(this.fYN[p]-this.fYN[d]))*((this.fXN[c]-this.fXN[d])*(this.fXN[c]-this.fXN[d])+(this.fYN[c]-this.fYN[d])*(this.fYN[c]-this.fYN[d]))),A=((this.fXN[p]-this.fXN[d])*(this.fXN[X]-this.fXN[d])+(this.fYN[p]-this.fYN[d])*(this.fYN[X]-this.fYN[d]))/Math.sqrt(((this.fXN[p]-this.fXN[d])*(this.fXN[p]-this.fXN[d])+(this.fYN[p]-this.fYN[d])*(this.fYN[p]-this.fYN[d]))*((this.fXN[X]-this.fXN[d])*(this.fXN[X]-this.fXN[d])+(this.fYN[X]-this.fYN[d])*(this.fYN[X]-this.fYN[d]))),!(z>O||z>A)){if(C=Math.sqrt((this.fXN[c]-this.fXN[d])*(this.fXN[c]-this.fXN[d])+(this.fYN[c]-this.fYN[d])*(this.fYN[c]-this.fYN[d])),Z=Math.sqrt((this.fXN[c]-this.fXN[p])*(this.fXN[c]-this.fXN[p])+(this.fYN[c]-this.fYN[p])*(this.fYN[c]-this.fYN[p])),E=Math.sqrt((this.fXN[X]-this.fXN[d])*(this.fXN[X]-this.fXN[d])+(this.fYN[X]-this.fYN[d])*(this.fYN[X]-this.fYN[d])),F=Math.sqrt((this.fXN[X]-this.fXN[p])*(this.fXN[X]-this.fXN[p])+(this.fYN[X]-this.fYN[p])*(this.fYN[X]-this.fYN[p])),I=((this.fXN[c]-this.fXN[d])*(this.fXN[c]-this.fXN[p])+(this.fYN[c]-this.fYN[d])*(this.fYN[c]-this.fYN[p]))/C/Z,k=((this.fXN[X]-this.fXN[d])*(this.fXN[X]-this.fXN[p])+(this.fYN[X]-this.fYN[d])*(this.fYN[X]-this.fYN[p]))/E/F,b=I*Math.sqrt(1-k*k)+k*Math.sqrt(1-I*I),b<-1e-6){t=!0;break}Math.abs(b)<=1e-6&&(G++,B=c,R=X,W=d,Q=p)}}else if(this.fXN[u]!==this.fXN[m]){if((this.fXN[c]-this.fXN[u])*(this.fXN[c]-this.fXN[m])<0){t=!0;break}(this.fXN[c]-this.fXN[u])*(this.fXN[c]-this.fXN[m])===0&&console.warn(`Interpolate Two of these three points are coincident ${u} ${m} ${c}`)}else{if((this.fYN[c]-this.fYN[u])*(this.fYN[c]-this.fYN[m])<0){t=!0;break}(this.fYN[c]-this.fYN[u])*(this.fYN[c]-this.fYN[m])===0&&console.warn(`Interpolate Two of these three points are coincident ${u} ${m} ${c}`)}}if(!t)return G>0?(Y=B,X=R,d=W,p=Q,this.fZ[d-1]+this.fZ[p-1]>this.fZ[Y-1]+this.fZ[X-1]?(g=e,M=r,x=n,this.FileIt(e,r,n),this.FileIt(Y,d,p)):(g=X,M=Y,x=this.Enclose(X,Y,d,0)?d:p,this.FileIt(X,Y,d),this.FileIt(X,Y,p))):(this.FileIt(e,r,n),g=e,M=r,x=n),s=this.InterpolateOnPlane(g,M,x,0),s}}return V&&console.error(`Interpolate Point outside hull when expected inside: this point could be dodgy ${t}  ${i} ${f}`),s}SetMaxIter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e5;this.fAllTri=!1,this.fMaxIter=t}SetMarginBinsContent(t){this.fZout=t}}function Y(t){let i=Math.floor(t.index/this.nvertex);if(i<0||i>=this.index.length)return null;const s=t=>t*t;i=this.index[i];const h=this.fp,f=this.graph;let e=h.grx(f.fX[i]),r=h.gry(f.fY[i]),n=h.grz(f.fZ[i]);if(this.check_next&&i+1<f.fX.length){const a=t.point,o=h.grx(f.fX[i+1]),l=h.gry(f.fY[i+1]),N=h.grz(f.fZ[i+1]);s(a.x-o)+s(a.y-l)+s(a.z-N)<s(a.x-e)+s(a.y-r)+s(a.z-n)&&(e=o,r=l,n=N,i++)}return{x1:e-this.scale0,x2:e+this.scale0,y1:r-this.scale0,y2:r+this.scale0,z1:n-this.scale0,z2:n+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+i,"x: "+h.axisAsText("x",f.fX[i]),"y: "+h.axisAsText("y",f.fY[i]),"z: "+h.axisAsText("z",f.fZ[i])]}}class d extends r.JW{decodeOptions(t,i){const s=new e.nC(t);this.options||(this.options={});const f=this.options,r=this.getObject();s.check("FILL_","color")&&r&&(r.fFillColor=s.color),s.check("LINE_","color")&&r&&(r.fLineColor=s.color),s.check("SAME"),s.check("TRI1")?f.Triangles=11:s.check("TRI2")?f.Triangles=10:s.check("TRIW")?f.Triangles=1:s.check("TRI")?f.Triangles=2:f.Triangles=0,f.Line=s.check("LINE"),f.Error=s.check("ERR")&&(this.matchObjectType(h.clTGraph2DErrors)||this.matchObjectType(h.clTGraph2DAsymmErrors)),s.check("P0COL")?f.Color=f.Circles=f.Markers=!0:(f.Color=s.check("COL"),f.Circles=s.check("P0"),f.Markers=s.check("P")),f.Markers||(f.Color=!1),(f.Color||f.Triangles>=10)&&(f.Zscale=s.check("Z")),f.isAny=function(){return this.Markers||this.Error||this.Circles||this.Line||this.Triangles},f.isAny()?(f.Axis="lego2",f.Zscale&&(f.Axis+="z")):f.Axis=t,this.storeDrawOpt(t)}createHistogram(){const t=this.getObject(),i=this.matchObjectType(h.clTGraph2DAsymmErrors);let s=t.fX[0],f=s,e=t.fY[0],r=e,n=t.fZ[0],a=n;for(let h=0;h<t.fNpoints;++h){const o=t.fX[h],l=t.fY[h],N=t.fZ[h];this.options.Error?(s=Math.min(s,o-(i?t.fEXlow[h]:t.fEX[h])),f=Math.max(f,o+(i?t.fEXhigh[h]:t.fEX[h])),e=Math.min(e,l-(i?t.fEYlow[h]:t.fEY[h])),r=Math.max(r,l+(i?t.fEYhigh[h]:t.fEY[h])),n=Math.min(n,N-(i?t.fEZlow[h]:t.fEZ[h])),a=Math.max(a,N+(i?t.fEZhigh[h]:t.fEZ[h]))):(s=Math.min(s,o),f=Math.max(f,o),e=Math.min(e,l),r=Math.max(r,l),n=Math.min(n,N),a=Math.max(a,N))}function o(t,i,s){return t<i?s*(i-t):Math.abs(t)<1e5?.02:.02*Math.abs(t)}const l=o(s,f,t.fMargin),N=o(e,r,t.fMargin),c=o(n,a,0);let X=s-l,Y=f+l,d=e-N,p=r+N,u=n-c,m=a+c;X<0&&s>=0&&(X=.98*s),Y>0&&f<=0&&(Y=0),d<0&&e>=0&&(d=.98*e),p>0&&r<=0&&(p=0),u<0&&n>=0&&(u=.98*n),m>0&&a<=0&&(m=0);const g=this.getObject();g.fMinimum!==h.kNoZoom&&(u=g.fMinimum),g.fMaximum!==h.kNoZoom&&(m=g.fMaximum),this._own_histogram=!0;const M=(0,h.createHistogram)(h.clTH2F,g.fNpx,g.fNpy);if(M.fName=g.fName+"_h",(0,h.setHistogramTitle)(M,g.fTitle),M.fXaxis.fXmin=X,M.fXaxis.fXmax=Y,M.fYaxis.fXmin=d,M.fYaxis.fXmax=p,M.fZaxis.fXmin=u,M.fZaxis.fXmax=m,M.fMinimum=u,M.fMaximum=m,M.fBits|=h.kNoStats,!this.options.isAny()){const t=this.buildDelaunay(g);if(t)for(let i=0;i<g.fNpx;++i){const s=X+(i+.5)/g.fNpx*(Y-X);for(let h=0;h<g.fNpy;++h){const f=d+(h+.5)/g.fNpy*(p-d),e=t.ComputeZ(s,f);M.fArray[M.getBin(i+1,h+1)]=e}}}return M}buildDelaunay(t){return this._delaunay||(this._delaunay=new X(t),this._delaunay.FindAllTriangles(),this._delaunay.fNdt||delete this._delaunay),this._delaunay}drawTriangles(t,i,s,h){const e=this.buildDelaunay(i);if(!e)return;const r=t.logz?i=>i<t.scale_zmin?-.1:t.grz(i):t.grz,n=2===this.options.Triangles,N=this.options.Triangles>=10||n,c=this.options.Triangles%10===1||n&&i.fLineColor!==i.fFillColor,X=new a.N7(s,r,0,2*t.size_z3d,c);for(X.loop=0;X.loop<2;++X.loop){X.createBuffers();for(let s=0;s<e.fNdt;++s){const h=[e.fPTried[s],e.fNTried[s],e.fMTried[s]],f=[];let n=!0;for(let s=0;s<3;++s){const e=h[s]-1;f.push(t.grx(i.fX[e]),t.gry(i.fY[e]),r(i.fZ[e])),(i.fX[e]<t.scale_xmin||i.fX[e]>t.scale_xmax||i.fY[e]<t.scale_ymin||i.fY[e]>t.scale_ymax)&&(n=!1)}N&&n&&X.addMainTriangle(...f),c&&n&&(X.addLineSegment(f[0],f[1],f[2],f[3],f[4],f[5]),X.addLineSegment(f[3],f[4],f[5],f[6],f[7],f[8]),X.addLineSegment(f[6],f[7],f[8],f[0],f[1],f[2]))}}X.callFuncs(((e,r)=>{const a=(0,l.cD)(this.getMainPainter(),r,null,100,100),N=n?this.getColor(i.fFillColor):h.calcColor(e,s.length),c=new f.V9B((0,o.Bx)(N,{side:f.$EB,vertexColors:!1})),X=new f.eaF(a,c);t.add3DMesh(X,this),X.painter=this}),((s,h)=>{const e=this.getColor(i.fLineColor),r=new f.mrM({color:new f.Q1f(e),linewidth:i.fLineWidth}),n=(0,o.Fc)((0,l.QK)(this.getMainPainter(),h,100,100),r);t.add3DMesh(n,this)}))}updateObject(t,i){if(!this.matchObjectType(t))return!1;if(i&&i!==this.options.original&&this.decodeOptions(i,t),Object.assign(this.getObject(),t),delete this._delaunay,delete this.$redraw_hist,this.axes_draw){const t=this.getMainPainter();t?.updateObject(this.createHistogram(),this.options.Axis),this.$redraw_hist=t}return!0}async redraw(){let t=Promise.resolve(!0);return this.$redraw_hist&&(t=this.$redraw_hist.redraw(),delete this.$redraw_hist),t.then((()=>this.drawGraph2D()))}async drawGraph2D(){const t=this.getMainPainter(),i=this.getFramePainter(),s=this.getObject();if(!s||!t||!i||!i.mode3d)return this;if(i.remove3DMeshes(this),!this.options.isAny()){if(t.draw_content)return this;1===s.fMarkerSize&&1===s.fMarkerStyle?this.options.Circles=!0:this.options.Markers=!0}const e=(t,h)=>{let f=0;for(let e=0;e<s.fNpoints;++e)s.fX[e]<i.scale_xmin||s.fX[e]>i.scale_xmax||s.fY[e]<i.scale_ymin||s.fY[e]>i.scale_ymax||s.fZ[e]<t||s.fZ[e]>=h||++f;return f};let r=1;if(h.settings.OptimizeDraw>0&&!i.webgl){const t=e(i.scale_zmin,i.scale_zmax),s=5e4;t>s&&(r=Math.floor(t/s),r<=2&&(r=2))}const n=this.createAttMarker({attr:s,std:!1}),a=[];let l=null,N=[i.scale_zmin,i.scale_zmax],c=i.size_x3d/100*n.getFullSize();this.options.Circles&&(c=.06*i.size_x3d),i.usesvg&&(c*=.3),c*=7*Math.max(i.size_x3d/i.getFrameWidth(),i.size_z3d/i.getFrameHeight()),(this.options.Color||this.options.Triangles>=10)&&(N=t.getContourLevels(!0),l=t.getHistPalette()),this.options.Triangles&&this.drawTriangles(i,s,N,l);for(let X=0;X<N.length-1;++X){const t=Math.max(N[X],i.scale_zmin),n=Math.min(N[X+1],i.scale_zmax);if(t>=n)continue;const d=Math.floor(e(t,n)/r),p=new Int32Array(d);let u=null,m=0,g=0,M=null,x=!1,T=null,w=0,y=0;(this.options.Markers||this.options.Circles)&&(u=new o._l(d,i.webgl,c/3)),this.options.Error&&(M=new Float32Array(6*d*3),x=this.matchObjectType(h.clTGraph2DAsymmErrors)),this.options.Line&&(T=new Float32Array(6*(d-1)));for(let h=0;h<s.fNpoints;++h){if(s.fX[h]<i.scale_xmin||s.fX[h]>i.scale_xmax||s.fY[h]<i.scale_ymin||s.fY[h]>i.scale_ymax||s.fZ[h]<t||s.fZ[h]>=n)continue;if(r>1&&(m=(m+1)%r,0!==m))continue;p[g++]=h;const f=i.grx(s.fX[h]),e=i.gry(s.fY[h]),a=i.grz(s.fZ[h]);u&&u.addPoint(f,e,a),M&&(M[w]=i.grx(s.fX[h]-(x?s.fEXlow[h]:s.fEX[h])),M[w+1]=e,M[w+2]=a,M[w+3]=i.grx(s.fX[h]+(x?s.fEXhigh[h]:s.fEX[h])),M[w+4]=e,M[w+5]=a,w+=6,M[w]=f,M[w+1]=i.gry(s.fY[h]-(x?s.fEYlow[h]:s.fEY[h])),M[w+2]=a,M[w+3]=f,M[w+4]=i.gry(s.fY[h]+(x?s.fEYhigh[h]:s.fEY[h])),M[w+5]=a,w+=6,M[w]=f,M[w+1]=e,M[w+2]=i.grz(s.fZ[h]-(x?s.fEZlow[h]:s.fEZ[h])),M[w+3]=f,M[w+4]=e,M[w+5]=i.grz(s.fZ[h]+(x?s.fEZhigh[h]:s.fEZ[h])),w+=6),T&&(y>=6&&(T[y]=T[y-3],T[y+1]=T[y-2],T[y+2]=T[y-1],y+=3),T[y]=f,T[y+1]=e,T[y+2]=a,y+=3)}if(T&&y>3&&T.length===y){const t=this.getColor(s.fLineColor),h=new f.mrM({color:new f.Q1f(t),linewidth:s.fLineWidth}),e=(0,o.Fc)(T,h);i.add3DMesh(e,this),e.graph=s,e.index=p,e.fp=i,e.scale0=.7*c,e.tip_name=this.getObjectHint(),e.tip_color=3===s.fMarkerColor?16711680:65280,e.nvertex=2,e.check_next=!0,e.tooltip=Y}if(M){const t=this.getColor(s.fLineColor),h=new f.mrM({color:new f.Q1f(t),linewidth:s.fLineWidth}),e=(0,o.Fc)(M,h);i.add3DMesh(e,this),e.graph=s,e.index=p,e.fp=i,e.scale0=.7*c,e.tip_name=this.getObjectHint(),e.tip_color=3===s.fMarkerColor?16711680:65280,e.nvertex=6,e.tooltip=Y}if(u){let t="blue";this.options.Circles&&!this.options.Color||(t=l?.calcColor(X,N.length)??this.getColor(s.fMarkerColor));const h=u.createPoints({color:t,style:this.options.Circles?4:s.fMarkerStyle}).then((t=>{t.graph=s,t.fp=i,t.tip_color=3===s.fMarkerColor?16711680:65280,t.scale0=.3*c,t.index=p,t.tip_name=this.getObjectHint(),t.tooltip=Y,i.add3DMesh(t,this)}));a.push(h)}}return Promise.all(a).then((()=>{if(this.options.Zscale&&this.axes_draw){const t=this.getMainPainter()?.findFunction(h.clTPaletteAxis),i=this.getPadPainter()?.findPainterFor(t);return i?.drawPave()}})).then((()=>(i.render3D(100),this)))}static async draw(t,i,s){const h=new d(t,i);h.decodeOptions(s,i);let f=Promise.resolve(null);return h.getMainPainter()||(f=n.TH2Painter.draw(t,h.createHistogram(),h.options.Axis),h.axes_draw=!0),f.then((()=>(h.addToPadPrimitives(),h.drawGraph2D())))}}}}]);
//# sourceMappingURL=6197.b4aeb33e.chunk.js.map